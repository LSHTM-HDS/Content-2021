
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>15. Generalised Linear Models: Poisson Regression for Count Variables &#8212; Statistics for Health Data Science</title>
    
  <link href="_static/css/theme.css" rel="stylesheet" />
  <link href="_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/sphinx-book-theme.e8e5499552300ddf5d7adccae7cc3b70.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="16. Extensions: Confounding, standardization, and collapsibility" href="16.%20Extensions%20Confounding%2C%20standardization%2C%20and%20collapsibility.html" />
    <link rel="prev" title="14 Logistic Regression" href="14.%20Logistic%20Regression.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
      <img src="_static/logo.jpg" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Statistics for Health Data Science</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="00.%20Welcome.html">
   Welcome to Statistics for Health Data Science
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Overview
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="01.%20Introduction.html">
   1 Introduction
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Basic probability
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="02.a.%20Probability.Discrete.html">
   2. Probability and Discrete Probability Distributions
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="02.b.%20Probability.Discrete.html">
     2.1 Bayes’ Theorem
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="02.c.%20Probability.Discrete.html">
     2.2 The binomial distribution
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="02.d.%20Probability.Discrete.html">
     2.3 The Poisson distribution
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="03.a.%20Continuous%20Probability%20Distributions.html">
   3. Continuous probability distributions
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="03.b.%20Continuous%20Probability%20Distributions.html">
     3.1 Continuous random variables
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03.c.%20Continuous%20Probability%20Distributions.html">
     3.2 Useful continuous distributions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03.d.%20Continuous%20Probability%20Distributions.html">
     3.3 Uses of the standard Normal distribution
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03.e.%20Continuous%20Probability%20Distributions.html">
     3.5 Are the data normally distributed?
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03.f.%20Continuous%20Probability%20Distributions.html">
     3.5 Joint distributions and correlations
    </a>
   </li>
  </ul>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Statistical Inference
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="04.a.%20Population.and.samples.html">
   4. Populations and Samples
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="04.b.%20Population.and.samples.html">
     4.1 Sampling from a population
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="04.c.%20Population.and.samples.html">
     4.2 Statistical Models
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="04.d.%20Population.and.samples.html">
     4.3 Sampling distributions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="04.e.%20Population.and.samples.html">
     4.4 Obtaining the sampling distribution
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="04.f.%20Population.and.samples.html">
     4.5 Summary
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="04.g.%20Population.and.samples.html">
     Appendix: additional reading
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="05.a.%20Likelihood.html">
   5. Likelihood
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="05.b.%20Likelihood.html">
     5. Likelihood
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="05.c.%20Likelihood.html">
     5. Likelihood
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="05.d.%20Likelihood.html">
     5. Likelihood
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="05.f.%20Likelihood.html">
     5. Likelihood
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="05.g.%20Likelihood.html">
     5. Likelihood
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="06.a.%20Maximum%20Likelihood.html">
   6. Maximum Likelihood
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="06.b.%20Maximum%20Likelihood.html">
     6.1 Likelihood and log-likelihood with
     <span class="math notranslate nohighlight">
      \(n\)
     </span>
     independent observations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="06.c.%20Maximum%20Likelihood.html">
     6.2 Properties of maximum likelihood estimators
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="06.d.%20Maximum%20Likelihood.html">
     6.3 Summary
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="06.e.%20Maximum%20Likelihood.html">
     Appendix: Additional Reading
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="07.a.%20Frequentist%20I.html">
   7. Frequentist I: Confidence Intervals (CIs)
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="07.b.%20Frequentist%20I.html">
     7.1 Introduction to confidence intervals
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="07.c.%20Frequentist%20I.html">
     7.2 95% confidence intervals for the mean
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="07.d.%20Frequentist%20I.html">
     7.3 Interpretation of confidence intervals
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="07.e.%20Frequentist%20I.html">
     7.4 Approximate confidence intervals for parameters estimated using large samples
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="07.f.%20Frequentist%20I.html">
     7.5 Confidence Intervals using resampling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="07.g.%20Frequentist%20I.html">
     7.6 Summary: Use of confidence intervals
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="07.h.%20Frequentist%20I.html">
     Further resources
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="08.a.%20Frequentist%20II.html">
   8. Frequentist II: Hypothesis tests
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="08.b.%20Frequentist%20II.html">
     8.1 Proving and disproving hypotheses
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="08.c.%20Frequentist%20II.html">
     8.2 The p-value
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="08.d.%20Frequentist%20II.html">
     8.3 Connection between p-values and confidence intervals
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="08.e.%20Frequentist%20II.html">
     8.4 Other (mis-)interpretations of p-values
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="08.f.%20Frequentist%20II.html">
     8.5 Calculating p-values
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="08.g.%20Frequentist%20II.html">
     Further resources
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="09.%20Bayesian%20Statistics%20I.html">
   9. Bayesian Statistics I
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="10.%20Bayesian%20Statistics%20II.html">
   10. Bayesian Statistics II: Normal data
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Statistical modelling
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="11.%20Types%20of%20Investigation.html">
   11. Types of Investigation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="12.%20Linear%20Regression%20I.html">
   12. Linear Regression I
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="13.%20Linear%20Regression%20II.html">
   13. Linear Regression II
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="14.%20Logistic%20Regression.html">
   14 Logistic Regression
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   15. Generalised Linear Models: Poisson Regression for Count Variables
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="16.%20Extensions%20Confounding%2C%20standardization%2C%20and%20collapsibility.html">
   16. Extensions: Confounding, standardization, and collapsibility
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/15. Poisson Regression Model.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/LSHTM-HDS/Content-2021"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/LSHTM-HDS/Content-2021/issues/new?title=Issue%20on%20page%20%2F15. Poisson Regression Model.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/LSHTM-HDS/Content-2021/master?urlpath=tree/docs/15. Poisson Regression Model.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction-to-count-data-and-poisson-distribution">
   15.1 Introduction to Count Data and Poisson Distribution:
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#introduction-to-count-data">
     15.1.1 Introduction to Count Data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#why-can-t-we-just-use-ordinary-linear-regression">
     15.1.2 Why can’t we just use Ordinary Linear Regression?
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#poisson-distribution-recap">
     15.1.3 Poisson Distribution Recap
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#what-is-the-poisson-distribution">
       15.1.3.1 What is the Poisson Distribution
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#rules-for-using-the-poisson">
       15.1.3.2 Rules for using the Poisson!
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#poisson-distribution-characteristics">
       15.1.3.3 Poisson Distribution Characteristics
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction-to-poisson-generalised-linear-modelling-poisson-regression">
   15.2 Introduction to Poisson generalised linear modelling (Poisson Regression)
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#brief-introduction-to-poisson-regression">
     15.2.1 Brief Introduction to Poisson Regression
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#common-problems-in-poisson-regression">
     15.2.2 Common Problems in Poisson Regression
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#overdispersion">
     15.2.3 Overdispersion
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#quasi-poisson-regression">
     15.2.4 Quasi-Poisson regression
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#zero-inflation">
     15.2.5 Zero inflation
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#poisson-regression-in-health-data-science">
   15.3 Poisson regression in health data science
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#how-to-fit-a-poisson-regression-in-r">
   15.4 How to fit a Poisson Regression in R
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#data-for-poisson-regression-example">
     15.4.1 Data for Poisson Regression Example
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#output-from-poisson-regression-example">
     15.4.2 Output from Poisson Regression Example
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#creating-robust-standard-errors-from-poisson-regression-example-output">
     15.4.3 Creating robust standard errors from Poisson regression example output.
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#poisson-regression-goodness-of-fit-example">
     15.4.4 Poisson Regression Goodness of Fit Example
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#poisson-regression-example-used-for-prediction">
     15.4.5 Poisson Regression Example used for Prediction
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#zero-inflated-poisson-regression-example">
   15.5 Zero Inflated Poisson Regression Example
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="generalised-linear-models-poisson-regression-for-count-variables">
<h1>15. Generalised Linear Models: Poisson Regression for Count Variables<a class="headerlink" href="#generalised-linear-models-poisson-regression-for-count-variables" title="Permalink to this headline">¶</a></h1>
<p>In this session we explore Poisson regression models, which are used when the outcome of interest is a count variable.</p>
<div class="alert alert-block alert-warning">
<b> Intended learning outcomes</b> 
<p>By the end of this session, you will be able to:</p>
<ul class="simple">
<li><p>explain what discrete data is and when it may be present in health data science;</p></li>
<li><p>describe the Poisson regression model;</p></li>
<li><p>apply the Poisson regression model to analyse data and evaluate the findings;</p></li>
<li><p>describe other health data science methods suitable to model count data when Poisson regression is not appropriate.</p></li>
</ul>
</div><div class="section" id="introduction-to-count-data-and-poisson-distribution">
<h2>15.1 Introduction to Count Data and Poisson Distribution:<a class="headerlink" href="#introduction-to-count-data-and-poisson-distribution" title="Permalink to this headline">¶</a></h2>
<div class="section" id="introduction-to-count-data">
<h3>15.1.1 Introduction to Count Data<a class="headerlink" href="#introduction-to-count-data" title="Permalink to this headline">¶</a></h3>
<p>Quantitative data can be divided generally into two sub groups: continuous and discrete. Discrete data typically involves integers which cannot be made with greater precision, for example, the number of operations a patient has undergone cannot have divisible entities i.e. 2.8 operations makes no sense. However, continuous data can have non integers which can be increased in precision for example a volume of liquid could be recorded in litres, mililitres, millimillilitre and so on.</p>
<p>Count data is a discrete data type which can only take non-negative integer values, for example {0, 1, 2, 3, …}. These integers should arise from counting and not ranking. Count data is common in health data, for example the number of readmissions to hospital a person has would be classed as count data.</p>
<p>When count data is treated as a random variable where possible values represent the possible outcomes of say a future experiment, then count data can be modelled by the Poisson, binomial and negative binomial distributions. This section only focuses on using the Poisson distribution, however briefly to cover how the other two distribution can be used if we think of clinical trials as a dichotomised variable defined as success or fail then:</p>
<p>•	Binomial distribution can be used to describe the count of successful trials achieved in a total number of trials, given a constant probability of success.</p>
<p>•	Negative binomial distribution can be used to describe the count of successful trials until observing a defined number of failures, given a constant probability of success.</p>
</div>
<div class="section" id="why-can-t-we-just-use-ordinary-linear-regression">
<h3>15.1.2 Why can’t we just use Ordinary Linear Regression?<a class="headerlink" href="#why-can-t-we-just-use-ordinary-linear-regression" title="Permalink to this headline">¶</a></h3>
<p>One of the main assumptions required for fitting an ordinary linear regression (OLR) is that the residual errors must follow a normal distribution. For this to be achieved with data from a skewed distribution, a transformation must be applied however with discrete data this can be very problematic (making the interpretation of the findings unfeasibly difficult) or impossible (for example, a high number of 0’s could prevent normality from being achieved). Another issue is that an OLR has the ability to create negative predicted values which would be theoretically impossible. For these reasons it is better to apply a method which actually reflects the natural distribution instead of trying to make the distribution reflect the method. This is why a Poisson regression is generally more suited to count data than OLR.</p>
</div>
<div class="section" id="poisson-distribution-recap">
<h3>15.1.3 Poisson Distribution Recap<a class="headerlink" href="#poisson-distribution-recap" title="Permalink to this headline">¶</a></h3>
<div class="section" id="what-is-the-poisson-distribution">
<h4>15.1.3.1 What is the Poisson Distribution<a class="headerlink" href="#what-is-the-poisson-distribution" title="Permalink to this headline">¶</a></h4>
<p>The Poisson distribution was first published by Siméon Denis Poisson in 1838. Poisson was a French mathematician, engineer, and physicist, his name is one of 72 engraved on the Eiffel Tower in Paris. The Poisson distribution is a skewed, discrete distribution restricted to non-negative numbers. The shape of the distribution is defined by the shape parameter <span class="math notranslate nohighlight">\(\lambda\)</span> which represents the average number of events in the given time interval. As <span class="math notranslate nohighlight">\(\lambda\)</span> increases the distribution looks more and more like the normal distribution. When <span class="math notranslate nohighlight">\(\lambda\)</span> is about 10 or greater, then a normal distribution is a good approximation.</p>
<p>Please play with changing lambda (<span class="math notranslate nohighlight">\(\lambda\)</span>) in the example below to discover its effects on the shape of the distribution:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">options</span><span class="p">(</span><span class="n">repr.plot.width</span><span class="o">=</span><span class="m">6</span><span class="p">,</span> <span class="n">repr.plot.height</span><span class="o">=</span><span class="m">3</span><span class="p">)</span>
<span class="nf">options</span><span class="p">(</span><span class="n">warn</span><span class="o">=</span><span class="m">-1</span><span class="p">)</span>

<span class="c1">#Number of data points</span>
<span class="n">n</span><span class="o">&lt;-</span><span class="m">10</span><span class="o">^</span><span class="m">6</span>
<span class="c1">#Lambda is the shape parameter which indicates the average number of events in the given time interval.</span>
<span class="c1">#Please try different values.</span>
<span class="n">lambda</span><span class="o">&lt;-</span> <span class="m">3</span>

<span class="c1">#Simulate Sample</span>
<span class="n">y</span> <span class="o">=</span> <span class="nf">rpois</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">lambda</span><span class="p">);</span>  <span class="n">up</span><span class="o">=</span><span class="nf">max</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

<span class="c1">#Plot histogram </span>
<span class="nf">hist</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">prob</span><span class="o">=</span><span class="bp">T</span><span class="p">,</span> <span class="n">br</span><span class="o">=</span><span class="p">(</span><span class="m">-1</span><span class="o">:</span><span class="n">up</span><span class="p">)</span><span class="m">+.5</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s">&quot;skyblue2&quot;</span><span class="p">,</span> <span class="n">xlab</span><span class="o">=</span><span class="s">&quot;x&quot;</span><span class="p">,</span> 
  <span class="n">main</span><span class="o">=</span><span class="s">&quot;Simulated Sample from Poisson distribution with Normal Approximation&quot;</span><span class="p">,</span> <span class="n">cex.main</span><span class="o">=</span><span class="m">0.8</span><span class="p">)</span>
<span class="nf">curve</span><span class="p">(</span><span class="nf">dnorm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nf">mean</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="nf">sd</span><span class="p">(</span><span class="n">y</span><span class="p">)),</span> <span class="n">col</span><span class="o">=</span><span class="s">&quot;red&quot;</span><span class="p">,</span> <span class="n">lwd</span><span class="o">=</span><span class="m">2</span><span class="p">,</span> <span class="n">add</span><span class="o">=</span><span class="bp">T</span><span class="p">)</span>
<span class="c1">#dnorm here is creating the PDF for a normal distribution to plot on the graph. </span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/15. Poisson Regression Model_3_0.png" src="_images/15. Poisson Regression Model_3_0.png" />
</div>
</div>
</div>
<div class="section" id="rules-for-using-the-poisson">
<h4>15.1.3.2 Rules for using the Poisson!<a class="headerlink" href="#rules-for-using-the-poisson" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>There should not be a limit for how any times an event can occur during a time period.</p></li>
<li><p>For example, if there was a rule that a participant can only have two hospital appointments in a year, then the resulting counts for all participants would not be a Poisson distribution.</p></li>
<li><p>Events must occur independently. If an event occurs, then it should not affect the probability of another event occurring in the same period.</p></li>
<li><p>For example, if a participant has a hospital appointment in which they are told they must come back 5 more times in the year.</p></li>
<li><p>The average rate of events occurring should be constant and not affected by time.</p></li>
<li><p>For example, if the participants are not allowed to have hospital appointments in the first 11 months of a year.</p></li>
<li><p>The probability of an event occurring is proportional to the length of the time period being examined.</p></li>
<li><p>For example, a participant should be twice as likely to have an appointment in 2 months compared to 1 month.</p></li>
<li><p>Two events cannot occur at exactly the same instant.</p>
<ul>
<li><p>For example, a participant cannot have two appointments at the same time.</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="poisson-distribution-characteristics">
<h4>15.1.3.3 Poisson Distribution Characteristics<a class="headerlink" href="#poisson-distribution-characteristics" title="Permalink to this headline">¶</a></h4>
<p>General Characteristics:</p>
<ul class="simple">
<li><p>Mean: <span class="math notranslate nohighlight">\(\mu\)</span> = <span class="math notranslate nohighlight">\(\lambda\)</span></p></li>
<li><p>Variance: <span class="math notranslate nohighlight">\(\lambda\)</span></p></li>
<li><p>Range: 0 to <span class="math notranslate nohighlight">\(\infty\)</span></p></li>
<li><p>Standard Deviation:  <span class="math notranslate nohighlight">\(\sqrt{ \lambda}\)</span></p></li>
<li><p>Coefficient of Variation:	<span class="math notranslate nohighlight">\(\frac{1}{\sqrt{ \lambda}}\)</span></p></li>
</ul>
<p>To determine the distribution of a discrete random variable we can either provide its Probability Mass Function (PMF) or Cumulative Density Function (CDF).</p>
<p>The formal definition of a <strong>PMF</strong> is it is a function over the sample space of a discrete random variable <span class="math notranslate nohighlight">\(X\)</span> which gives the probability that <span class="math notranslate nohighlight">\(x\)</span> is equal to a certain value. In count data terms it means it is a function of the count variable which can return the probability of any count value being observed, i.e. it can give the probability of say participants having 2 hospital appointments in a year.</p>
<p>If <span class="math notranslate nohighlight">\(X\)</span> (a discrete random variable) is assumed to have a Poisson distribution with parameter <span class="math notranslate nohighlight">\(\lambda&gt;0\)</span>, for counts <span class="math notranslate nohighlight">\(x\)</span> = 0,1,2,…, the PMF of <span class="math notranslate nohighlight">\(X\)</span> is given by:</p>
<div class="math notranslate nohighlight">
\[ f(x; \lambda) = P(X=x) = \frac{\lambda^{x}e^{-\lambda}}{x!}\]</div>
<p>Where <span class="math notranslate nohighlight">\(e\)</span> is Euler’s number (<span class="math notranslate nohighlight">\(e=2.71\)</span>…) and <span class="math notranslate nohighlight">\(x!\)</span> is a factorial (i.e. <span class="math notranslate nohighlight">\(3!=3x2x1\)</span> and <span class="math notranslate nohighlight">\(5!= 5x4x3x2x1\)</span>).The positive real number <span class="math notranslate nohighlight">\(\lambda\)</span> is equal to the expected value of <span class="math notranslate nohighlight">\(X\)</span> and also the expected variance of <span class="math notranslate nohighlight">\(X\)</span> (in a Poisson distribution the mean and variance are the same).</p>
<p>The previous graph represents a plot of the Poisson PMF, you can see that as you increase and decrease <span class="math notranslate nohighlight">\(\lambda\)</span> the shape of the graph changes.</p>
<p>The formal definition of a <strong>CDF</strong> is it is a function over the sample space of a discrete random variable <span class="math notranslate nohighlight">\(X\)</span> which gives the probability that <span class="math notranslate nohighlight">\(x\)</span> is less than or equal to a certain value. In count data terms it means it is a function of the count variable which can return the probability of being less than or equal to a count value, i.e. it can give the probability of say participants having less than or equal to 3 hospital appointments in a year.</p>
<div class="math notranslate nohighlight">
\[ f(x; \lambda) = P(X\leq x) = \sum_{i=0}^{x} \frac{\lambda^{i}e^{-\lambda}}{i!}\]</div>
<p>The following graph shows the Poisson cumulative distribution function, please change <span class="math notranslate nohighlight">\(\lambda\)</span> to explore the effects:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">options</span><span class="p">(</span><span class="n">repr.plot.width</span><span class="o">=</span><span class="m">4</span><span class="p">,</span> <span class="n">repr.plot.height</span><span class="o">=</span><span class="m">3</span><span class="p">)</span>
<span class="c1">#Number of data points</span>
<span class="n">n</span><span class="o">&lt;-</span><span class="m">10</span><span class="o">^</span><span class="m">6</span>
<span class="c1">#Lambda is the shape parameter which indicates the average number of events in the given time interval.</span>
<span class="c1">#Please try different values.</span>
<span class="n">lambda</span><span class="o">&lt;-</span> <span class="m">3</span>

<span class="c1">#Simulate Sample</span>
<span class="n">y</span> <span class="o">=</span> <span class="nf">rpois</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">lambda</span><span class="p">)</span>

<span class="c1">#Plot </span>
<span class="nf">plot</span><span class="p">(</span><span class="nf">ecdf</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">col</span> <span class="o">=</span> <span class="s">&quot;blue&quot;</span><span class="p">,</span> <span class="n">lwd</span> <span class="o">=</span> <span class="m">2</span><span class="p">,</span>
     <span class="n">main</span> <span class="o">=</span> <span class="s">&quot;CDF of Simulated Poisson Sample&quot;</span><span class="p">,</span> <span class="n">ylab</span><span class="o">=</span><span class="s">&quot;Probability&quot;</span><span class="p">,</span> <span class="n">xlab</span><span class="o">=</span><span class="s">&quot;Count&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/15. Poisson Regression Model_5_0.png" src="_images/15. Poisson Regression Model_5_0.png" />
</div>
</div>
</div>
</div>
</div>
<div class="section" id="introduction-to-poisson-generalised-linear-modelling-poisson-regression">
<h2>15.2 Introduction to Poisson generalised linear modelling (Poisson Regression)<a class="headerlink" href="#introduction-to-poisson-generalised-linear-modelling-poisson-regression" title="Permalink to this headline">¶</a></h2>
<div class="section" id="brief-introduction-to-poisson-regression">
<h3>15.2.1 Brief Introduction to Poisson Regression<a class="headerlink" href="#brief-introduction-to-poisson-regression" title="Permalink to this headline">¶</a></h3>
<p>Poisson generalised linear modelling is commonly known as Poisson regression but is sometimes referred to as a log-linear model. Poisson regression is the generalised linear model form of a regression analysis. It is fitted to data when the outcome is assumed to have a Poisson distribution.</p>
<p>Poisson regression assumes the outcome variable has a Poisson distribution and uses a logarithm as the canonical link function. A link function acts as a bridge between a linear predictor and the mean of the distribution function of choice. The canonical link function is basically the “well-defined” link function and is derived from the exponential density function of the distribution.</p>
<p>Say we want to model <span class="math notranslate nohighlight">\(\mathbf{Y}\)</span> using Poisson Regression so <span class="math notranslate nohighlight">\(\mathbf{Y} \sim P(\mu)\)</span> and let the mean <span class="math notranslate nohighlight">\(\mu\)</span> (and therefore the variance) depend on a vector of explanatory variables <span class="math notranslate nohighlight">\(\mathbf{X}\)</span>. We will need to take the linear predictor <span class="math notranslate nohighlight">\(\mathbf{X}^T\mathbf{\beta}\)</span> and combine it with a link function (<span class="math notranslate nohighlight">\(g\)</span>) so that the left hand side of the predictor <span class="math notranslate nohighlight">\(\mu\)</span> is always non-negative. We include the link function like this:</p>
<p><span class="math notranslate nohighlight">\(E[\mathbf{Y}|\mathbf{X}] = \mu = g^{-1} (\mathbf{X}^T\mathbf{\beta})\)</span></p>
<p>Similarly the variance of <span class="math notranslate nohighlight">\(\mathbf{Y}\)</span> (Var<span class="math notranslate nohighlight">\([\mathbf{Y}]\)</span>) is written:</p>
<p><span class="math notranslate nohighlight">\( Var[\mathbf{Y}|\mathbf{X}] = Var[\mu] =Var[ g^{-1} (\mathbf{X}^T\mathbf{\beta})]\)</span></p>
<p>The canonical link function for Poisson regression is the logarithm, thus:</p>
<p><span class="math notranslate nohighlight">\( ln(E[\mathbf{Y} | \mathbf{X}]) = ln(\mu) = \mathbf{X}^T\mathbf{\beta}\)</span></p>
<p>Here <span class="math notranslate nohighlight">\(\beta\)</span> contains the regression coefficients. An element of <span class="math notranslate nohighlight">\(\beta\)</span> represents the expected change in the natural <span class="math notranslate nohighlight">\(log\)</span> of the mean per unit change of one explanatory variable in <span class="math notranslate nohighlight">\(X\)</span> (constraining the other elements to not change).</p>
<p>If you wanted to find the expected value of the outcome variable <span class="math notranslate nohighlight">\(\mathbf{Y}\)</span> given <span class="math notranslate nohighlight">\(\mathbf{X}\)</span> then the equation looks like this:</p>
<p><span class="math notranslate nohighlight">\( E[\mathbf{Y}|\mathbf{X}]  = \mu = e^{\mathbf{X^T\beta}}\)</span>,</p>
<p>where <span class="math notranslate nohighlight">\(\mathbf{\beta}\)</span> can be estimated by the maximum likelihood.</p>
</div>
<div class="section" id="common-problems-in-poisson-regression">
<h3>15.2.2 Common Problems in Poisson Regression<a class="headerlink" href="#common-problems-in-poisson-regression" title="Permalink to this headline">¶</a></h3>
<p>There are two frequent common problems when applying Poisson Regression to count data and both are caused by the deviations from the Poisson distribution assumptions. The first problem is overdispersion and the second is zero inflation.</p>
</div>
<div class="section" id="overdispersion">
<h3>15.2.3 Overdispersion<a class="headerlink" href="#overdispersion" title="Permalink to this headline">¶</a></h3>
<p>Overdispersion happens with then the variance is no longer equal to the mean but larger. Below is an example of overdispersion.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">options</span><span class="p">(</span><span class="n">repr.plot.width</span><span class="o">=</span><span class="m">4</span><span class="p">,</span> <span class="n">repr.plot.height</span><span class="o">=</span><span class="m">3</span><span class="p">)</span>
<span class="c1">#Input some counts</span>
<span class="n">data</span><span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="m">26</span><span class="p">,</span><span class="m">30</span><span class="p">,</span><span class="m">54</span><span class="p">,</span><span class="m">25</span><span class="p">,</span><span class="m">70</span><span class="p">,</span><span class="m">52</span><span class="p">,</span><span class="m">51</span><span class="p">,</span><span class="m">26</span><span class="p">,</span><span class="m">67</span><span class="p">,</span><span class="m">18</span><span class="p">,</span><span class="m">21</span><span class="p">,</span><span class="m">29</span><span class="p">,</span><span class="m">17</span><span class="p">,</span><span class="m">12</span><span class="p">,</span><span class="m">18</span><span class="p">,</span><span class="m">35</span><span class="p">,</span><span class="m">30</span><span class="p">,</span><span class="m">36</span><span class="p">,</span><span class="m">36</span><span class="p">,</span><span class="m">21</span><span class="p">,</span><span class="m">24</span><span class="p">,</span><span class="m">18</span><span class="p">,</span><span class="m">10</span><span class="p">,</span><span class="m">43</span><span class="p">,</span><span class="m">28</span><span class="p">,</span><span class="m">15</span><span class="p">,</span><span class="m">26</span><span class="p">,</span><span class="m">27</span><span class="p">,</span><span class="m">14</span><span class="p">,</span><span class="m">29</span><span class="p">,</span><span class="m">19</span><span class="p">,</span><span class="m">29</span><span class="p">,</span><span class="m">31</span><span class="p">,</span><span class="m">41</span><span class="p">,</span><span class="m">20</span><span class="p">,</span><span class="m">44</span><span class="p">,</span><span class="m">42</span><span class="p">,</span><span class="m">26</span><span class="p">,</span><span class="m">19</span><span class="p">,</span><span class="m">16</span><span class="p">,</span><span class="m">39</span><span class="p">,</span><span class="m">28</span><span class="p">,</span><span class="m">21</span><span class="p">,</span><span class="m">39</span><span class="p">,</span><span class="m">29</span><span class="p">,</span><span class="m">20</span><span class="p">,</span><span class="m">21</span><span class="p">,</span><span class="m">24</span><span class="p">,</span><span class="m">17</span><span class="p">,</span><span class="m">13</span><span class="p">,</span><span class="m">15</span><span class="p">,</span><span class="m">15</span><span class="p">,</span><span class="m">16</span><span class="p">,</span><span class="m">28</span><span class="p">)</span>
<span class="c1">#Histogram of counts</span>
<span class="nf">hist</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">xlab</span><span class="o">=</span><span class="s">&quot;Counts&quot;</span><span class="p">,</span> <span class="n">main</span><span class="o">=</span><span class="s">&quot;Histogram of Counts&quot;</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s">&quot;blue&quot;</span><span class="p">)</span>
<span class="c1">#Mean</span>
<span class="nf">print</span><span class="p">(</span><span class="s">&quot;The Mean is&quot;</span><span class="p">)</span>
<span class="nf">mean</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="c1">#Variance</span>
<span class="nf">print</span><span class="p">(</span><span class="s">&quot;The Variance is&quot;</span><span class="p">)</span>
<span class="nf">var</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="c1"># The mean is a lot smaller than the variance, suggesting overdispersion</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1] &quot;The Mean is&quot;
</pre></div>
</div>
<div class="output text_html">28.1481481481481</div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1] &quot;The Variance is&quot;
</pre></div>
</div>
<div class="output text_html">174.204053109713</div><img alt="_images/15. Poisson Regression Model_7_4.png" src="_images/15. Poisson Regression Model_7_4.png" />
</div>
</div>
<p>We can see here that the variance is a lot larger than the mean which would violate the Poisson distribution principles. There are two main ways to handle overdispersion, the first is through using a negative binomial distribution (not covered here) instead and the second is to implement something called a quasi-likelihood through a Generalised Poisson Regression also called a Quasi-Poisson regression.</p>
</div>
<div class="section" id="quasi-poisson-regression">
<h3>15.2.4 Quasi-Poisson regression<a class="headerlink" href="#quasi-poisson-regression" title="Permalink to this headline">¶</a></h3>
<p>A Quasi-Poisson regression is often fitted to handle over-dispersion, it uses the same mean regression function and variance function from Poisson regression but allows the dispersion parameter <span class="math notranslate nohighlight">\(\phi\)</span> to be unrestriced from 1. In Poisson regression <span class="math notranslate nohighlight">\(\phi\)</span> is assumed to be fixed at 1 to make the mean and variance equal, in Quasi-Poisson regression <span class="math notranslate nohighlight">\(\phi\)</span> is not fixed and is estimated from the data. Quasi- Poisson regression leads to the same coefficient estimates as the Poisson regression model but inference are adjusted for the over-dispersion through the standard errors.</p>
</div>
<div class="section" id="zero-inflation">
<h3>15.2.5 Zero inflation<a class="headerlink" href="#zero-inflation" title="Permalink to this headline">¶</a></h3>
<p>Zero inflation happens when the distribution contains a large number of zero’s. For example, if you were to count how many occasions people drank alcohol in a month but included a large number of non-drinkers you will expect to have multiple counts of 0. A zero inflated Poisson distribution often looks like this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">options</span><span class="p">(</span><span class="n">repr.plot.width</span><span class="o">=</span><span class="m">4</span><span class="p">,</span> <span class="n">repr.plot.height</span><span class="o">=</span><span class="m">3</span><span class="p">)</span>
<span class="c1">#Install package</span>
<span class="nf">install.packages</span><span class="p">(</span><span class="s">&quot;VGAM&quot;</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="s">&quot;VGAM&quot;</span><span class="p">)</span>

<span class="c1">#Number of data points to simulate</span>
<span class="n">n</span><span class="o">=</span><span class="m">100</span>
<span class="c1">#Shape</span>
<span class="n">lambda</span><span class="o">=</span><span class="m">3</span>
<span class="c1">#Probability of drawing a zero</span>
<span class="n">p</span><span class="o">=</span><span class="m">0.5</span>
<span class="c1">#Create data</span>
<span class="n">zip</span><span class="o">&lt;-</span><span class="nf">rzipois</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">lambda</span> <span class="o">=</span> <span class="n">lambda</span><span class="p">,</span> <span class="n">pstr0</span> <span class="o">=</span> <span class="n">p</span><span class="p">)</span>
<span class="c1">#Plot Histogram</span>
<span class="nf">hist</span><span class="p">(</span><span class="n">zip</span><span class="p">,</span> <span class="n">xlab</span><span class="o">=</span><span class="s">&quot;Counts&quot;</span><span class="p">,</span> <span class="n">main</span><span class="o">=</span><span class="s">&quot;Histogram of Counts&quot;</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s">&quot;blue&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>package &#39;VGAM&#39; successfully unpacked and MD5 sums checked
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The downloaded binary packages are in
	C:\Users\emsuewil\AppData\Local\Temp\Rtmpi6KOCz\downloaded_packages
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Loading required package: stats4
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Loading required package: splines
</pre></div>
</div>
<img alt="_images/15. Poisson Regression Model_9_4.png" src="_images/15. Poisson Regression Model_9_4.png" />
</div>
</div>
<p>A Zero-Inflated Poisson (ZIP) distribution can be thought of being generated by two processes, the first generates zeros and the second is generated by the Poisson distribution (which will contain zeros). The two processes look like this:</p>
<p><span class="math notranslate nohighlight">\(P[\mathbf{Y}=0] = \pi (1-\pi)e^{- \lambda }\)</span>,</p>
<p><span class="math notranslate nohighlight">\(P[\mathbf{Y}=k] = (1-\pi)\frac{\lambda^{k}e^{-\lambda}}{k!}\)</span>,</p>
<p>Where <span class="math notranslate nohighlight">\(k\)</span> is a non-negative integer value, <span class="math notranslate nohighlight">\(\lambda\)</span> is the expected Poisson count and <span class="math notranslate nohighlight">\(\pi\)</span> is the probability of extra zeros. The mean of a ZIP is <span class="math notranslate nohighlight">\((1-\pi)\lambda\)</span> and the variance is <span class="math notranslate nohighlight">\(\lambda (1-\pi) (1+\pi \lambda)\)</span>.</p>
<p>When fitting a ZIP regression the software package combines two parts, a Poisson regression and logistic regression to predict the excess zeros.</p>
</div>
</div>
<div class="section" id="poisson-regression-in-health-data-science">
<h2>15.3 Poisson regression in health data science<a class="headerlink" href="#poisson-regression-in-health-data-science" title="Permalink to this headline">¶</a></h2>
<p>Poisson regression in of limted use in health data science due to the constraint that the mean and variance need to be the same. This is a characteristic which is often not adhered to in real data sets and usually a data scientist turns to other methods, for example negative binomial regression or generalised Poisson regression. Also when the expected counts (lambda) is large (which often arises in health data science) a normal approximation of the distribution will often give equivocal results. However, it is very important to understand Poisson regression if you are planning on doing health data science on rare events as it will increase the likelihood that a Poisson distribution is observed.</p>
</div>
<div class="section" id="how-to-fit-a-poisson-regression-in-r">
<h2>15.4 How to fit a Poisson Regression in R<a class="headerlink" href="#how-to-fit-a-poisson-regression-in-r" title="Permalink to this headline">¶</a></h2>
<p>Similarly to other generalised linear regressions, we fit a Poisson regression through the generalised linear models function glm() where we tell R what the distribution of the errors and linear predictor should be.</p>
<p>You should already be familiar with the glm() function but a quick recap the function syntax is as followed:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>glm(formula, family = gaussian, data, weights, subset,
na.action, start = NULL, etastart, mustart, offset,
control = list(…), model = TRUE, method = &quot;glm.fit&quot;,
x = FALSE, y = TRUE, singular.ok = TRUE, contrasts = NULL, …)
</pre></div>
</div>
<p>The minimal inputted parameters required is the <em>formula</em> and the <em>family</em>. The <em>formula</em> tells R in a symbolic description what model is required to be fitted and the <em>family</em> describes what error distribution and link function are required. As we are going to be fitting Poisson regression the <em>family</em> will be “poisson”, however we can also fit a Quasi-Poisson regression also by setting <em>family</em> to “quasipoisson”.</p>
<div class="section" id="data-for-poisson-regression-example">
<h3>15.4.1 Data for Poisson Regression Example<a class="headerlink" href="#data-for-poisson-regression-example" title="Permalink to this headline">¶</a></h3>
<p>For the purpose of illustration, we will simulate some data and pretend it comes from a clinical trial. We generate 100 participants (<span class="math notranslate nohighlight">\(n\)</span>) in three variables. The first is a count variable representing the number of hospital admissions a participant has had in a year and it is created from a Poisson distribution with <span class="math notranslate nohighlight">\(lambda=2\)</span>. The second is a categorical variable with 4 groups representing the country a participant lives in (England, Northern Ireland, Scotland, Wales) and the last is a binary variable representing which treatment arm the participant was randomised to. Let’s start with simulating the data and looking at some descriptive statistics.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1">## Simulate Data</span>
<span class="nf">set.seed</span><span class="p">(</span><span class="m">42</span><span class="p">)</span>
<span class="n">n</span><span class="o">&lt;-</span><span class="m">100</span>
<span class="n">lambda</span><span class="o">&lt;-</span><span class="m">6</span>
<span class="n">counts</span> <span class="o">&lt;-</span> <span class="nf">rpois</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">lambda</span><span class="p">)</span>
<span class="n">country</span> <span class="o">&lt;-</span>  <span class="nf">factor</span><span class="p">(</span><span class="nf">sample</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="bp">T</span><span class="p">),</span> <span class="n">levels</span><span class="o">=</span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;England&quot;</span><span class="p">,</span><span class="s">&quot;Northern Ireland&quot;</span><span class="p">,</span><span class="s">&quot;Scotland&quot;</span><span class="p">,</span><span class="s">&quot;Wales&quot;</span><span class="p">))</span>
<span class="n">treatment</span> <span class="o">&lt;-</span> <span class="nf">factor</span><span class="p">(</span><span class="nf">gl</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="n">n</span><span class="o">/</span><span class="m">2</span><span class="p">),</span> <span class="n">levels</span><span class="o">=</span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;Active Arm&quot;</span><span class="p">,</span> <span class="s">&quot;Placebo Arm&quot;</span><span class="p">))</span>
<span class="nf">print</span><span class="p">(</span><span class="n">df</span> <span class="o">&lt;-</span> <span class="nf">data.frame</span><span class="p">(</span><span class="n">treatment</span><span class="p">,</span> <span class="n">country</span><span class="p">,</span> <span class="n">counts</span><span class="p">))</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>  
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      treatment          country counts
1    Active Arm Northern Ireland      9
2    Active Arm            Wales     10
3    Active Arm          England      5
4    Active Arm Northern Ireland      8
5    Active Arm          England      7
6    Active Arm Northern Ireland      6
7    Active Arm            Wales      7
8    Active Arm         Scotland      3
9    Active Arm            Wales      7
10   Active Arm          England      7
11   Active Arm            Wales      6
12   Active Arm          England      7
13   Active Arm            Wales     10
14   Active Arm         Scotland      4
15   Active Arm Northern Ireland      6
16   Active Arm Northern Ireland     10
17   Active Arm         Scotland     11
18   Active Arm          England      3
19   Active Arm          England      6
20   Active Arm Northern Ireland      6
21   Active Arm         Scotland      9
22   Active Arm            Wales      3
23   Active Arm            Wales     12
24   Active Arm Northern Ireland     10
25   Active Arm            Wales      3
26   Active Arm          England      6
27   Active Arm          England      5
28   Active Arm            Wales      9
29   Active Arm          England      6
30   Active Arm          England      8
31   Active Arm          England      7
32   Active Arm Northern Ireland      8
33   Active Arm         Scotland      5
34   Active Arm          England      7
35   Active Arm Northern Ireland      1
36   Active Arm            Wales      8
37   Active Arm            Wales      1
38   Active Arm          England      4
39   Active Arm         Scotland      9
40   Active Arm Northern Ireland      7
41   Active Arm          England      5
42   Active Arm          England      5
43   Active Arm Northern Ireland      2
44   Active Arm          England     11
45   Active Arm          England      5
46   Active Arm         Scotland     11
47   Active Arm            Wales      9
48   Active Arm Northern Ireland      7
49   Active Arm         Scotland     11
50   Active Arm Northern Ireland      7
51  Placebo Arm Northern Ireland      5
52  Placebo Arm            Wales      5
53  Placebo Arm          England      5
54  Placebo Arm         Scotland      8
55  Placebo Arm          England      2
56  Placebo Arm          England      8
57  Placebo Arm          England      7
58  Placebo Arm         Scotland      4
59  Placebo Arm         Scotland      4
60  Placebo Arm            Wales      6
61  Placebo Arm          England      7
62  Placebo Arm Northern Ireland     12
63  Placebo Arm Northern Ireland      8
64  Placebo Arm         Scotland      6
65  Placebo Arm Northern Ireland      9
66  Placebo Arm            Wales      4
67  Placebo Arm         Scotland      4
68  Placebo Arm         Scotland      8
69  Placebo Arm Northern Ireland      7
70  Placebo Arm          England      4
71  Placebo Arm            Wales      2
72  Placebo Arm          England      3
73  Placebo Arm            Wales      4
74  Placebo Arm Northern Ireland      6
75  Placebo Arm          England      4
76  Placebo Arm Northern Ireland      7
77  Placebo Arm         Scotland      1
78  Placebo Arm Northern Ireland      5
79  Placebo Arm Northern Ireland      6
80  Placebo Arm            Wales      0
81  Placebo Arm Northern Ireland      6
82  Placebo Arm Northern Ireland      4
83  Placebo Arm Northern Ireland      5
84  Placebo Arm         Scotland      7
85  Placebo Arm Northern Ireland      8
86  Placebo Arm            Wales      6
87  Placebo Arm            Wales      4
88  Placebo Arm         Scotland      3
89  Placebo Arm Northern Ireland      3
90  Placebo Arm Northern Ireland      5
91  Placebo Arm         Scotland      7
92  Placebo Arm            Wales      0
93  Placebo Arm Northern Ireland      4
94  Placebo Arm            Wales     10
95  Placebo Arm            Wales     10
96  Placebo Arm Northern Ireland      7
97  Placebo Arm          England      5
98  Placebo Arm          England      6
99  Placebo Arm Northern Ireland      7
100 Placebo Arm            Wales      7
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>       treatment              country       counts     
 Active Arm :50   England         :27   Min.   : 0.00  
 Placebo Arm:50   Northern Ireland:31   1st Qu.: 4.00  
                  Scotland        :18   Median : 6.00  
                  Wales           :24   Mean   : 6.14  
                                        3rd Qu.: 8.00  
                                        Max.   :12.00  
</pre></div>
</div>
</div>
</div>
<p>We can see that we correctly have 100 participants with 50% in the active arm and 50% in the placebo arm. There is roughly equal number of participants in each country with Northern Ireland having slightly more. The number of hospital admissions ranges from 0 to 6 with the median number of admissions equal to 2.</p>
<p>We can now have a look at the descriptive statistics for admission counts by both treatment and county.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1">#Counts by treatment</span>
<span class="nf">with</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="nf">tapply</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">treatment</span><span class="p">,</span> <span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">{</span>
  <span class="nf">sprintf</span><span class="p">(</span><span class="s">&quot;M (SD) = %1.2f (%1.2f)&quot;</span><span class="p">,</span> <span class="nf">mean</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nf">sd</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="p">}))</span>
<span class="c1">#Counts by country</span>
<span class="nf">with</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="nf">tapply</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">country</span><span class="p">,</span> <span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">{</span>
  <span class="nf">sprintf</span><span class="p">(</span><span class="s">&quot;M (SD) = %1.2f (%1.2f)&quot;</span><span class="p">,</span> <span class="nf">mean</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nf">sd</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="p">}))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><dl class=dl-horizontal>
	<dt>Active Arm</dt>
		<dd>'M (SD) = 6.78 (2.70)'</dd>
	<dt>Placebo Arm</dt>
		<dd>'M (SD) = 5.50 (2.46)'</dd>
</dl>
</div><div class="output text_html"><dl class=dl-horizontal>
	<dt>England</dt>
		<dd>'M (SD) = 5.74 (1.87)'</dd>
	<dt>Northern Ireland</dt>
		<dd>'M (SD) = 6.48 (2.34)'</dd>
	<dt>Scotland</dt>
		<dd>'M (SD) = 6.39 (3.07)'</dd>
	<dt>Wales</dt>
		<dd>'M (SD) = 5.96 (3.42)'</dd>
</dl>
</div></div>
</div>
<p>We can see that the Active arm has a slightly higher count mean than the Placebo arm and Scotland also has a slightly higher mean count. We can also look at this graphically using the ggplot package.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">options</span><span class="p">(</span><span class="n">repr.plot.width</span><span class="o">=</span><span class="m">4</span><span class="p">,</span> <span class="n">repr.plot.height</span><span class="o">=</span><span class="m">3</span><span class="p">)</span>
<span class="nf">install.packages</span><span class="p">(</span><span class="s">&quot;ggplot2&quot;</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span>
<span class="n">g1</span><span class="o">&lt;-</span><span class="nf">ggplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">fill</span> <span class="o">=</span> <span class="n">treatment</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_histogram</span><span class="p">(</span><span class="n">binwidth</span><span class="o">=</span><span class="n">.</span><span class="m">5</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s">&quot;dodge&quot;</span><span class="p">)</span>
<span class="n">g1</span> <span class="o">+</span> <span class="nf">labs</span><span class="p">(</span><span class="n">fill</span> <span class="o">=</span> <span class="s">&quot;Treament Arm&quot;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s">&quot;Admission Count&quot;</span><span class="p">)</span>

<span class="n">g2</span><span class="o">&lt;-</span><span class="nf">ggplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">fill</span> <span class="o">=</span> <span class="n">country</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_histogram</span><span class="p">(</span><span class="n">binwidth</span><span class="o">=</span><span class="n">.</span><span class="m">5</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s">&quot;dodge&quot;</span><span class="p">)</span>
<span class="n">g2</span> <span class="o">+</span> <span class="nf">labs</span><span class="p">(</span><span class="n">fill</span> <span class="o">=</span> <span class="s">&quot;Country&quot;</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="s">&quot;Admission Count&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  There is a binary version available but the source version is later:
        binary source needs_compilation
ggplot2  3.3.3  3.3.5             FALSE
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>installing the source package &#39;ggplot2&#39;
</pre></div>
</div>
<img alt="_images/15. Poisson Regression Model_18_2.png" src="_images/15. Poisson Regression Model_18_2.png" />
<img alt="_images/15. Poisson Regression Model_18_3.png" src="_images/15. Poisson Regression Model_18_3.png" />
</div>
</div>
</div>
<div class="section" id="output-from-poisson-regression-example">
<h3>15.4.2 Output from Poisson Regression Example<a class="headerlink" href="#output-from-poisson-regression-example" title="Permalink to this headline">¶</a></h3>
<p>We already know the admissions count variable follows a Poisson distribution as we have simulated the data directly from the distribution without adding noise. Therefore we know a Poisson regression is suitable. We now fit the regression model and store it in the object m1 and get a summary of the model at the same time.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">summary</span><span class="p">(</span><span class="n">m1</span> <span class="o">&lt;-</span> <span class="nf">glm</span><span class="p">(</span><span class="n">counts</span> <span class="o">~</span> <span class="n">treatment</span> <span class="o">+</span> <span class="n">country</span><span class="p">,</span> <span class="n">family</span><span class="o">=</span><span class="s">&quot;poisson&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Call:
glm(formula = counts ~ treatment + country, family = &quot;poisson&quot;, 
    data = df)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-3.2467  -0.5783   0.0477   0.6381   2.2260  

Coefficients:
                        Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)              1.82733    0.08448  21.631  &lt; 2e-16 ***
treatmentPlacebo Arm    -0.23187    0.08226  -2.819  0.00482 ** 
countryNorthern Ireland  0.17001    0.10822   1.571  0.11620    
countryScotland          0.14936    0.12396   1.205  0.22822    
countryWales             0.06669    0.11640   0.573  0.56670    
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 130.13  on 99  degrees of freedom
Residual deviance: 120.53  on 95  degrees of freedom
AIC: 483.69

Number of Fisher Scoring iterations: 5
</pre></div>
</div>
</div>
</div>
<p><strong>OUTPUT</strong></p>
<p>The first part of the output gives information on deviance residuals. We would expect to see the deviance residuals to be approximately normally distributed if the model is correctly specified. Here we can see the median is close to 0 (-0.10) and there does not appear to be any skewness as Q1 (quartile 1 = -0.67) and Q3 (quartile 3 = 0.73) have a similar distance from the median and so are the minimum and maximum.</p>
<p>The second part of the output gives the Poisson regression coefficients for each variable with their standard errors, z values, p-values. We interpret Poisson regression coefficients as if there was a one unit change in the predictor variable (if a continuous variable otherwise change from the reference category to the category listed) the regression coefficient tells us the effect on the logs of the expected counts (admission counts in our example), given the other variables in the model are held constant. The coefficient for treatment is -0.40 which tells use the expected log admissions count for being randomised to the active arm compared to the placebo arm is -0.40. The expected log admissions count for the other countries compared to England are all positive.</p>
<p>We can also see the regression estimate when all the variables in the model are evaluated at zero (or categorical reference group) and this is called the constant and labelled “_cons”. In our model this would represent the expected log admissions count for participants in the placebo arm who live in England.</p>
<p>The standard errors are given which are used to calculate the z-value which in turn is used to calculate the p value. The null hypothesis for each p value is that the corresponding regression coefficient is zero given the rest of the variables in the model. The z value here is just the ratio of the coefficient to the standard error for example treatment we can see the estimate/standard error equals the z value: -0.3971/0.1421=-2.795. The z value follows a normal distribution and is tested against a two-sided alternative hypothesis that the coefficient is not equal to zero. We can see for treatment the p value is 0.005 and if we set out alpha significant level at <span class="math notranslate nohighlight">\(\alpha=0.05\)</span> we would reject the null hypothesis and conclude the Poisson regression coefficient for treatment is statistically different from zero, given country is in the model.</p>
<p>Lastly, at the bottom of the output, we have information on the residual deviance which can be used to perform a goodness of fit test for the overall model. We will come back to this in section 14.5.4.</p>
</div>
<div class="section" id="creating-robust-standard-errors-from-poisson-regression-example-output">
<h3>15.4.3 Creating robust standard errors from Poisson regression example output.<a class="headerlink" href="#creating-robust-standard-errors-from-poisson-regression-example-output" title="Permalink to this headline">¶</a></h3>
<p>As previously covered in section 14.2.3.3, the mean of the Poisson distribution is equal to the variance. A publication here (<a class="reference external" href="https://onlinelibrary.wiley.com/doi/full/10.1111/1475-4932.12006">https://onlinelibrary.wiley.com/doi/full/10.1111/1475-4932.12006</a>) recommends using robust standard errors when this assumption is mildly violated. We can create robust standard errors using the sandwich package in R.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1">#Robust SE&#39;s</span>
<span class="nf">install.packages</span><span class="p">(</span><span class="s">&quot;sandwich&quot;</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">sandwich</span><span class="p">)</span>
<span class="n">cov</span> <span class="o">&lt;-</span> <span class="nf">vcovHC</span><span class="p">(</span><span class="n">m1</span><span class="p">,</span> <span class="n">type</span><span class="o">=</span><span class="s">&quot;HC0&quot;</span><span class="p">)</span>
<span class="n">se</span> <span class="o">&lt;-</span> <span class="nf">sqrt</span><span class="p">(</span><span class="nf">diag</span><span class="p">(</span><span class="n">cov</span><span class="p">))</span>
<span class="n">robust.SE</span> <span class="o">&lt;-</span> <span class="nf">cbind</span><span class="p">(</span><span class="n">Estimate</span><span class="o">=</span> <span class="nf">coef</span><span class="p">(</span><span class="n">m1</span><span class="p">),</span> <span class="s">&quot;Robust SE&quot;</span> <span class="o">=</span> <span class="n">se</span><span class="p">,</span> <span class="s">&quot;Pr(&gt;|z|)&quot;</span> <span class="o">=</span> <span class="m">2</span> <span class="o">*</span> <span class="nf">pnorm</span><span class="p">(</span><span class="nf">abs</span><span class="p">(</span><span class="nf">coef</span><span class="p">(</span><span class="n">m1</span><span class="p">)</span><span class="o">/</span><span class="n">se</span><span class="p">)))</span>
<span class="n">robust.SE</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  There is a binary version available but the source version is later:
         binary source needs_compilation
sandwich  3.0-0  3.0-1             FALSE
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>installing the source package &#39;sandwich&#39;
</pre></div>
</div>
<div class="output text_html"><table>
<thead><tr><th></th><th scope=col>Estimate</th><th scope=col>Robust SE</th><th scope=col>Pr(&gt;|z|)</th></tr></thead>
<tbody>
	<tr><th scope=row>(Intercept)</th><td> 1.82733439</td><td>0.06412168 </td><td>2.000000   </td></tr>
	<tr><th scope=row>treatmentPlacebo Arm</th><td>-0.23187287</td><td>0.08541705 </td><td>1.993364   </td></tr>
	<tr><th scope=row>countryNorthern Ireland</th><td> 0.17000567</td><td>0.09156736 </td><td>1.936635   </td></tr>
	<tr><th scope=row>countryScotland</th><td> 0.14936415</td><td>0.11986847 </td><td>1.787260   </td></tr>
	<tr><th scope=row>countryWales</th><td> 0.06668722</td><td>0.12436880 </td><td>1.408183   </td></tr>
</tbody>
</table>
</div></div>
</div>
<p>Here we have the robust standard errors (Robust SE) and the new calculated p values. In this example we see that the robust standard errors are very similar to the previous calculated standard errors, this is because we know the distribution was simulated from a Poisson distribution and hence the mean and variance are approximately the same. However in other settings calculating the robust standard error would lead less bias if the mean and variance were slightly different.</p>
</div>
<div class="section" id="poisson-regression-goodness-of-fit-example">
<h3>15.4.4 Poisson Regression Goodness of Fit Example<a class="headerlink" href="#poisson-regression-goodness-of-fit-example" title="Permalink to this headline">¶</a></h3>
<p>At the bottom of the output we see the null deviance and residual deviance from the model. The residual deviance is 104.71 on 95 degrees of freedom (df). There are 100 observations in our model and 5 estimates which gives us 95 df (100-1df for treatment- 3df for each country – 1df for the constant) . To calculate the p-value for the deviance goodness of fit test we simply calculate the probability to the right of the deviance value for the chi-squared distribution on 95 df.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">pchisq</span><span class="p">(</span><span class="n">m1</span><span class="o">$</span><span class="n">deviance</span><span class="p">,</span> <span class="n">df</span><span class="o">=</span><span class="n">m1</span><span class="o">$</span><span class="n">df.residual</span><span class="p">,</span> <span class="n">lower.tail</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">0.0395607905595946</div></div>
</div>
<p>The null hypothesis is that our model is correctly specified. Here we can see the p value is 0.233 which is not significant if we set our level of significant at 0.05. We therefore do not have strong evidence to reject the null hypothesis. If however there was strong evidence that the model was not fitting well, a possible method to improve fit could be to omit a variable from the model which could be adversely affecting the linearity or dispersion criteria. For example we could fit an alternative model where we remove country.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Update m1 model dropping country</span>
<span class="n">m2</span> <span class="o">&lt;-</span> <span class="nf">update</span><span class="p">(</span><span class="n">m1</span><span class="p">,</span> <span class="n">.</span> <span class="o">~</span> <span class="n">.</span> <span class="o">-</span> <span class="n">country</span><span class="p">)</span>
<span class="c1"># Test models with chi square test</span>
<span class="nf">anova</span><span class="p">(</span><span class="n">m2</span><span class="p">,</span> <span class="n">m1</span><span class="p">,</span> <span class="n">test</span><span class="o">=</span><span class="s">&quot;Chisq&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table>
<thead><tr><th scope=col>Resid. Df</th><th scope=col>Resid. Dev</th><th scope=col>Df</th><th scope=col>Deviance</th><th scope=col>Pr(&gt;Chi)</th></tr></thead>
<tbody>
	<tr><td>98       </td><td>123.4508 </td><td>NA       </td><td>      NA </td><td>       NA</td></tr>
	<tr><td>95       </td><td>120.5336 </td><td> 3       </td><td>2.917207 </td><td>0.4045671</td></tr>
</tbody>
</table>
</div></div>
</div>
<p>We can see by the non-significant p value of 0.598 that by adding Country to the model we do not get an improve fit and thus the model would fit approximately as well without it.</p>
</div>
<div class="section" id="poisson-regression-example-used-for-prediction">
<h3>15.4.5 Poisson Regression Example used for Prediction<a class="headerlink" href="#poisson-regression-example-used-for-prediction" title="Permalink to this headline">¶</a></h3>
<p>One of the great things about regression is it can be used to make predictions, for example we may want to predict what the expected admissions counts would be for each country while assuming everyone is in the placebo treatment. To have a look how this will work we create a small dataset.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">dp</span> <span class="o">&lt;-</span> <span class="nf">data.frame</span><span class="p">(</span><span class="n">treatment</span> <span class="o">=</span> <span class="nf">factor</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="m">1</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;Placebo Arm&quot;</span><span class="p">)),</span> <span class="n">country</span> <span class="o">=</span> <span class="nf">factor</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="nf">levels</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">country</span><span class="p">)))</span>
<span class="n">dp</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table>
<thead><tr><th scope=col>treatment</th><th scope=col>country</th></tr></thead>
<tbody>
	<tr><td>Placebo Arm     </td><td>England         </td></tr>
	<tr><td>Placebo Arm     </td><td>Northern Ireland</td></tr>
	<tr><td>Placebo Arm     </td><td>Scotland        </td></tr>
	<tr><td>Placebo Arm     </td><td>Wales           </td></tr>
</tbody>
</table>
</div></div>
</div>
<p>We now use the output from the regression to predict the admissions counts for each country.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">predict</span><span class="p">(</span><span class="n">m1</span><span class="p">,</span> <span class="n">dp</span><span class="p">,</span> <span class="n">type</span><span class="o">=</span><span class="s">&quot;response&quot;</span><span class="p">,</span> <span class="n">se.fit</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><dl>
	<dt>$fit</dt>
		<dd><dl class=dl-horizontal>
	<dt>1</dt>
		<dd>4.9306041274169</dd>
	<dt>2</dt>
		<dd>5.84430214232171</dd>
	<dt>3</dt>
		<dd>5.72490336621881</dd>
	<dt>4</dt>
		<dd>5.27062387515433</dd>
</dl>
</dd>
	<dt>$se.fit</dt>
		<dd><dl class=dl-horizontal>
	<dt>1</dt>
		<dd>0.483047207431936</dd>
	<dt>2</dt>
		<dd>0.471629350298954</dd>
	<dt>3</dt>
		<dd>0.583886748993777</dd>
	<dt>4</dt>
		<dd>0.502721588866226</dd>
</dl>
</dd>
	<dt>$residual.scale</dt>
		<dd>1</dd>
</dl>
</div></div>
</div>
<p>In the output we can see the predicted number of admissions counts for each country assuming everyone is taking placebo treatment. Scotland has the highest predicted count with England having the lowest. We can also graphically show predictions for different permutations of data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">options</span><span class="p">(</span><span class="n">repr.plot.width</span><span class="o">=</span><span class="m">10</span><span class="p">,</span> <span class="n">repr.plot.height</span><span class="o">=</span><span class="m">3</span><span class="p">)</span>
<span class="c1">## Calculate and store predicted values</span>
<span class="n">df</span><span class="o">$</span><span class="n">pred</span> <span class="o">&lt;-</span> <span class="nf">predict</span><span class="p">(</span><span class="n">m1</span><span class="p">,</span> <span class="n">type</span><span class="o">=</span><span class="s">&quot;response&quot;</span><span class="p">)</span>

<span class="c1"># Create the plot</span>
<span class="nf">ggplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">country</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">pred</span><span class="p">,</span> <span class="n">colour</span> <span class="o">=</span> <span class="n">treatment</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_point</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">y</span> <span class="o">=</span> <span class="n">pred</span><span class="p">))</span> <span class="o">+</span> <span class="nf">labs</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="s">&quot;Treatment Arm&quot;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s">&quot;Expected number of admissions&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/15. Poisson Regression Model_35_0.png" src="_images/15. Poisson Regression Model_35_0.png" />
</div>
</div>
<p>Here we can see graphically the predicted admissions count for each country for each treatment arm, to have the lowest predicted number of hospital admissions you would want to be living in England and in the Placebo arm.</p>
</div>
</div>
<div class="section" id="zero-inflated-poisson-regression-example">
<h2>15.5 Zero Inflated Poisson Regression Example<a class="headerlink" href="#zero-inflated-poisson-regression-example" title="Permalink to this headline">¶</a></h2>
<p>As we discussed in section 14.3.4, often we are faced with a distribution which is looks like a Poisson distribution but has an inflated zero count. In this situation Poisson Regression would not be suitable however we can fit a Zero Inflated Poisson Regression, unfortunately the glm() function is incapable of this modelling approach so we need different package called pscl.</p>
<p>Below we simulate data using a similar example to section 14.5.1 but instead of hospital admissions count we are interested in number of alcoholic drinks drunk in a day (treatment and country remain the same). The count for alcoholic drinks has a large number of zeros and thus is suitable to model with a Zero Inflated Poisson Regression.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1">#Install package</span>
<span class="c1">#install.packages(&quot;VGAM&quot;)</span>
<span class="c1">#install.packages(&quot;pscl&quot;)</span>
<span class="nf">library</span><span class="p">(</span><span class="s">&quot;VGAM&quot;</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">pscl</span><span class="p">)</span>

<span class="c1">#Number of data points to simulate</span>
<span class="n">n</span><span class="o">=</span><span class="m">100</span>
<span class="c1">#Shape</span>
<span class="n">lambda</span><span class="o">=</span><span class="m">3</span>
<span class="c1">#Probability of drawing a zero</span>
<span class="n">p</span><span class="o">=</span><span class="m">0.5</span>
<span class="c1">#Create data</span>
<span class="n">alcohol_count</span><span class="o">&lt;-</span><span class="nf">rzipois</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">lambda</span> <span class="o">=</span> <span class="n">lambda</span><span class="p">,</span> <span class="n">pstr0</span> <span class="o">=</span> <span class="n">p</span><span class="p">)</span>
<span class="n">country</span> <span class="o">&lt;-</span>  <span class="nf">factor</span><span class="p">(</span><span class="nf">sample</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="bp">T</span><span class="p">),</span> <span class="n">levels</span><span class="o">=</span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;England&quot;</span><span class="p">,</span><span class="s">&quot;Northern Ireland&quot;</span><span class="p">,</span><span class="s">&quot;Scotland&quot;</span><span class="p">,</span><span class="s">&quot;Wales&quot;</span><span class="p">))</span>
<span class="n">treatment</span> <span class="o">&lt;-</span> <span class="nf">factor</span><span class="p">(</span><span class="nf">gl</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="n">n</span><span class="o">/</span><span class="m">2</span><span class="p">),</span> <span class="n">levels</span><span class="o">=</span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;Placebo Arm&quot;</span><span class="p">,</span><span class="s">&quot;Active Arm&quot;</span><span class="p">))</span>
<span class="nf">print</span><span class="p">(</span><span class="n">df</span> <span class="o">&lt;-</span> <span class="nf">data.frame</span><span class="p">(</span><span class="n">treatment</span><span class="p">,</span> <span class="n">country</span><span class="p">,</span> <span class="n">alcohol_count</span><span class="p">))</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">m1</span> <span class="o">&lt;-</span> <span class="nf">zeroinfl</span><span class="p">(</span><span class="n">alcohol_count</span> <span class="o">~</span> <span class="n">country</span> <span class="o">+</span> <span class="n">treatment</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">df</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Classes and Methods for R developed in the
Political Science Computational Laboratory
Department of Political Science
Stanford University
Simon Jackman
hurdle and zeroinfl functions by Achim Zeileis
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      treatment          country alcohol_count
1   Placebo Arm          England             4
2   Placebo Arm            Wales             0
3   Placebo Arm Northern Ireland             4
4   Placebo Arm            Wales             0
5   Placebo Arm          England             0
6   Placebo Arm          England             0
7   Placebo Arm Northern Ireland             6
8   Placebo Arm         Scotland             0
9   Placebo Arm          England             0
10  Placebo Arm Northern Ireland             0
11  Placebo Arm Northern Ireland             1
12  Placebo Arm Northern Ireland             2
13  Placebo Arm Northern Ireland             0
14  Placebo Arm            Wales             0
15  Placebo Arm         Scotland             0
16  Placebo Arm Northern Ireland             4
17  Placebo Arm         Scotland             1
18  Placebo Arm Northern Ireland             0
19  Placebo Arm          England             1
20  Placebo Arm          England             4
21  Placebo Arm         Scotland             0
22  Placebo Arm         Scotland             0
23  Placebo Arm          England             1
24  Placebo Arm Northern Ireland             6
25  Placebo Arm          England             0
26  Placebo Arm Northern Ireland             3
27  Placebo Arm          England             0
28  Placebo Arm Northern Ireland             0
29  Placebo Arm            Wales             0
30  Placebo Arm          England             0
31  Placebo Arm         Scotland             0
32  Placebo Arm            Wales             0
33  Placebo Arm Northern Ireland             0
34  Placebo Arm         Scotland             0
35  Placebo Arm Northern Ireland             8
36  Placebo Arm Northern Ireland             3
37  Placebo Arm Northern Ireland             0
38  Placebo Arm            Wales             4
39  Placebo Arm            Wales             1
40  Placebo Arm         Scotland             0
41  Placebo Arm          England             0
42  Placebo Arm         Scotland             1
43  Placebo Arm          England             0
44  Placebo Arm         Scotland             0
45  Placebo Arm Northern Ireland             1
46  Placebo Arm          England             0
47  Placebo Arm Northern Ireland             0
48  Placebo Arm            Wales             0
49  Placebo Arm Northern Ireland             0
50  Placebo Arm Northern Ireland             5
51   Active Arm          England             0
52   Active Arm         Scotland             0
53   Active Arm            Wales             0
54   Active Arm Northern Ireland             1
55   Active Arm Northern Ireland             0
56   Active Arm          England             3
57   Active Arm         Scotland             0
58   Active Arm         Scotland             1
59   Active Arm Northern Ireland             1
60   Active Arm         Scotland             2
61   Active Arm          England             3
62   Active Arm         Scotland             0
63   Active Arm         Scotland             0
64   Active Arm            Wales             5
65   Active Arm          England             0
66   Active Arm            Wales             0
67   Active Arm Northern Ireland             4
68   Active Arm Northern Ireland             0
69   Active Arm          England             5
70   Active Arm Northern Ireland             4
71   Active Arm         Scotland             0
72   Active Arm          England             3
73   Active Arm Northern Ireland             0
74   Active Arm         Scotland             0
75   Active Arm          England             4
76   Active Arm            Wales             0
77   Active Arm          England             0
78   Active Arm Northern Ireland             0
79   Active Arm         Scotland             0
80   Active Arm          England             0
81   Active Arm Northern Ireland             0
82   Active Arm            Wales             0
83   Active Arm Northern Ireland             0
84   Active Arm         Scotland             6
85   Active Arm         Scotland             0
86   Active Arm Northern Ireland             0
87   Active Arm            Wales             0
88   Active Arm          England             0
89   Active Arm         Scotland             0
90   Active Arm Northern Ireland             0
91   Active Arm          England             4
92   Active Arm          England             3
93   Active Arm          England             0
94   Active Arm Northern Ireland             0
95   Active Arm         Scotland             0
96   Active Arm Northern Ireland             0
97   Active Arm         Scotland             3
98   Active Arm Northern Ireland             2
99   Active Arm         Scotland             0
100  Active Arm         Scotland             0
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>       treatment              country   alcohol_count 
 Placebo Arm:50   England         :26   Min.   :0.00  
 Active Arm :50   Northern Ireland:34   1st Qu.:0.00  
                  Scotland        :26   Median :0.00  
                  Wales           :14   Mean   :1.14  
                                        3rd Qu.:2.00  
                                        Max.   :8.00  
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Call:
zeroinfl(formula = alcohol_count ~ country + treatment, data = df)

Pearson residuals:
    Min      1Q  Median      3Q     Max 
-0.7880 -0.7227 -0.4582  0.4130  4.6787 

Count model coefficients (poisson with log link):
                        Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)              1.03937    0.24093   4.314  1.6e-05 ***
countryNorthern Ireland  0.12880    0.24890   0.517    0.605    
countryScotland         -0.40356    0.37120  -1.087    0.277    
countryWales             0.08974    0.39442   0.228    0.820    
treatmentActive Arm      0.09866    0.22040   0.448    0.654    

Zero-inflation model coefficients (binomial with logit link):
                        Estimate Std. Error z value Pr(&gt;|z|)
(Intercept)               0.1425     0.4828   0.295    0.768
countryNorthern Ireland  -0.1511     0.5520  -0.274    0.784
countryScotland           0.7827     0.6597   1.186    0.235
countryWales              1.0468     0.7850   1.333    0.182
treatmentActive Arm       0.1377     0.4545   0.303    0.762
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 

Number of iterations in BFGS optimization: 15 
Log-likelihood: -130.1 on 10 Df
</pre></div>
</div>
</div>
</div>
<p>The model fits a glm with a binomial logit link to predict the excess zeros and a glm with a Possion log link to model the rest of the distribution. In both models the variables (country and treatment) have been included however you could use different variables in the two models. Unfortunately the models do not combine the estimates from each model however we can use the coefficients to make predictions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">$</span><span class="n">pred</span> <span class="o">&lt;-</span> <span class="nf">predict</span><span class="p">(</span><span class="n">m1</span><span class="p">,</span> <span class="n">type</span><span class="o">=</span><span class="s">&quot;response&quot;</span><span class="p">)</span>
<span class="c1"># Create the plot</span>
<span class="nf">ggplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">country</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">pred</span><span class="p">,</span> <span class="n">colour</span> <span class="o">=</span> <span class="n">treatment</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_point</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">y</span> <span class="o">=</span> <span class="n">pred</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="s">&quot;Treatment Arm&quot;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s">&quot;Expected number of drinks in a day&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/15. Poisson Regression Model_40_0.png" src="_images/15. Poisson Regression Model_40_0.png" />
</div>
</div>
<p>The graph shows the expected number of drinks in a day for each country and treatment group, from this we would expect the most number of drinks to be drunk in a day to be for people in the Placebo arm living in Wales, with the fewest from the Active arm people living in Northern Ireland.</p>
<p>To check if the zero inflated Poisson regression models the data better than the straight forward  Poisson regression we can run a Vuong test. A Vuong test is a likelihood ratio test used for model selection when the models are nested, non-nested or overlapping. The null hypothesis is that the two models supplied are equally close to the true data generation structure, against the alternative that one model is closer. To run a Vuong test in R we simple use the vuong() function and supply the two models we wish to compare in our case it is the zero inflated Poisson verses the Poisson model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1">#Zero inflated model</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">m1</span> <span class="o">&lt;-</span> <span class="nf">zeroinfl</span><span class="p">(</span><span class="n">alcohol_count</span> <span class="o">~</span> <span class="n">treatment</span> <span class="o">+</span> <span class="n">country</span> <span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">df</span><span class="p">))</span>
<span class="c1">#Poisson regression</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">m2</span> <span class="o">&lt;-</span> <span class="nf">glm</span><span class="p">(</span><span class="n">alcohol_count</span> <span class="o">~</span> <span class="n">treatment</span> <span class="o">+</span> <span class="n">country</span><span class="p">,</span> <span class="n">family</span><span class="o">=</span><span class="s">&quot;poisson&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">))</span>
<span class="c1">#Vuong test</span>
<span class="nf">vuong</span><span class="p">(</span><span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Call:
zeroinfl(formula = alcohol_count ~ treatment + country, data = df)

Pearson residuals:
    Min      1Q  Median      3Q     Max 
-0.7880 -0.7227 -0.4582  0.4130  4.6787 

Count model coefficients (poisson with log link):
                        Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)              1.03937    0.24093   4.314  1.6e-05 ***
treatmentActive Arm      0.09866    0.22040   0.448    0.654    
countryNorthern Ireland  0.12880    0.24890   0.517    0.605    
countryScotland         -0.40356    0.37120  -1.087    0.277    
countryWales             0.08974    0.39442   0.228    0.820    

Zero-inflation model coefficients (binomial with logit link):
                        Estimate Std. Error z value Pr(&gt;|z|)
(Intercept)               0.1425     0.4828   0.295    0.768
treatmentActive Arm       0.1377     0.4545   0.303    0.762
countryNorthern Ireland  -0.1511     0.5520  -0.274    0.784
countryScotland           0.7827     0.6597   1.186    0.235
countryWales              1.0468     0.7850   1.333    0.182
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 

Number of iterations in BFGS optimization: 15 
Log-likelihood: -130.1 on 10 Df
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Call:
glm(formula = alcohol_count ~ treatment + country, family = &quot;poisson&quot;, 
    data = df)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.8081  -1.6505  -1.0453   0.5542   4.2552  

Coefficients:
                        Estimate Std. Error z value Pr(&gt;|z|)   
(Intercept)              0.30905    0.19307   1.601  0.10945   
treatmentActive Arm     -0.02373    0.18885  -0.126  0.90000   
countryNorthern Ireland  0.18233    0.21651   0.842  0.39972   
countryScotland         -0.91355    0.31698  -2.882  0.00395 **
countryWales            -0.63542    0.35882  -1.771  0.07658 . 
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 270.46  on 99  degrees of freedom
Residual deviance: 250.66  on 95  degrees of freedom
AIC: 364.19

Number of Fisher Scoring iterations: 6
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Vuong Non-Nested Hypothesis Test-Statistic: 
(test-statistic is asymptotically distributed N(0,1) under the
 null that the models are indistinguishible)
-------------------------------------------------------------
              Vuong z-statistic             H_A    p-value
Raw                    4.474813 model1 &gt; model2 3.8239e-06
AIC-corrected          3.998462 model1 &gt; model2 3.1878e-05
BIC-corrected          3.377975 model1 &gt; model2 0.00036511
</pre></div>
</div>
</div>
</div>
<p>The output shows three z-statistics, the raw, the AIC-corrected and the BIC-corrected. In brief, the AIC (Akaike information criterion) and BIC (Bayesian information criterion) introduce a penalty term to reduce the likelihood of overfitting. When adding parameters to models it is possible to increase the likelihood, the penalty term adjusts for this increase; the penalty term is larger in BIC than in the AIC.</p>
<p>We can see in the output that for all three p values there is significantly strong evidence that model 1, the zero inflated Poisson regression fits the data far better than model 2 the Poisson regression. If however the p values did not agree then the data scientist would have to think about the affects of each method and decide if the raw, AIC or BIC would be the most appropriate in the setting being looked at. There is a debate about the use of Vuong test for this type of comparison, if you wish to read more there is a good paper which can be found here (<a class="reference external" href="https://www.sciencedirect.com/science/article/abs/pii/S016517651400490X">https://www.sciencedirect.com/science/article/abs/pii/S016517651400490X</a>).</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "r"
        },
        kernelOptions: {
            kernelName: "ir",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'ir'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="14.%20Logistic%20Regression.html" title="previous page">14 Logistic Regression</a>
    <a class='right-next' id="next-link" href="16.%20Extensions%20Confounding%2C%20standardization%2C%20and%20collapsibility.html" title="next page">16. Extensions: Confounding, standardization, and collapsibility</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By MSc Health Data Science, LSHTM<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>