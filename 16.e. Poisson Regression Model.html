
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>15.4 How to fit a Poisson Regression in R &#8212; Statistics for Health Data Science</title>
    
  <link href="_static/css/theme.css" rel="stylesheet" />
  <link href="_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/sphinx-book-theme.e8e5499552300ddf5d7adccae7cc3b70.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="15.5 Zero Inflated Poisson Regression Example" href="16.f.%20Poisson%20Regression%20Model.html" />
    <link rel="prev" title="15.3 Poisson regression in health data science" href="16.d.%20Poisson%20Regression%20Model.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
      <img src="_static/logo.jpg" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Statistics for Health Data Science</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="00.%20Welcome.html">
   Welcome to Statistics for Health Data Science
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Preamble
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="00.%20Acknowledgements.html">
   Acknowledgements
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="00.%20How_to_use.html">
   How to use this book
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Overview
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="01.%20Introduction.html">
   1 Introduction
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Basic probability
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="02.%20Probability.Intro.html">
   Probability and statistics
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="02.a.%20Probability.Discrete.html">
   2. Discrete Distributions
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="02.b.%20Probability.Discrete.html">
     Bayes' Theorem
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="02.c.%20Probability.Discrete.html">
     The binomial distribution
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="02.d.%20Probability.Discrete.html">
     The Poisson distribution
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="02.e.%20Probability.Discrete.html">
     Summary
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="03.a.%20Continuous%20Probability%20Distributions.html">
   3. Continuous distributions
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="03.b.%20Continuous%20Probability%20Distributions.html">
     3.1 Continuous random variables
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03.c.%20Continuous%20Probability%20Distributions.html">
     3.2 Useful continuous distributions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03.d.%20Continuous%20Probability%20Distributions.html">
     3.3 Uses of the standard Normal distribution
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03.e.%20Continuous%20Probability%20Distributions.html">
     3.4 Are the data normally distributed?
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03.f.%20Continuous%20Probability%20Distributions.html">
     3.5 Joint distributions and correlations
    </a>
   </li>
  </ul>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Statistical Inference
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="04.%20Inference.Intro.html">
   Statistical Inference
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="04.a.%20Population.and.samples.html">
   4. Populations and Samples
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="04.b.%20Population.and.samples.html">
     4.1 Sampling from a population
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="04.c.%20Population.and.samples.html">
     4.2 Statistical models
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="04.d.%20Population.and.samples.html">
     4.3 Sampling distributions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="04.e.%20Population.and.samples.html">
     4.4 Obtaining the sampling distribution
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="04.f.%20Population.and.samples.html">
     4.5 Summary
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="04.g.%20Population.and.samples.html">
     Appendix: additional reading
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="05.a.%20Likelihood.html">
   5. Likelihood
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="05.b.%20Likelihood.html">
     5.1 Maximum likelihood estimation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="05.c.%20Likelihood.html">
     5.2 The likelihood
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="05.d.%20Likelihood.html">
     5.3 Log likelihood
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="05.e.%20Likelihood.html">
     5.4 Finding the MLE
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="05.f.%20Likelihood.html">
     5.5 Summary
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="06.a.%20Maximum%20Likelihood.html">
   6. Maximum Likelihood
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="06.b.%20Maximum%20Likelihood.html">
     6.1 Likelihood with independent observations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="06.c.%20Maximum%20Likelihood.html">
     6.2 Properties of maximum likelihood estimators
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="06.d.%20Maximum%20Likelihood.html">
     6.3 Summary
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="06.e.%20Maximum%20Likelihood.html">
     Appendix: Additional Reading
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="07.a.%20Frequentist%20I.html">
   7. Frequentist I: Confidence Intervals
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="07.b.%20Frequentist%20I.html">
     7.1 Confidence intervals
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="07.c.%20Frequentist%20I.html">
     7.2 Confidence intervals for the mean
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="07.d.%20Frequentist%20I.html">
     7.3 Interpretation of confidence intervals
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="07.e.%20Frequentist%20I.html">
     7.4 Approximate confidence intervals for parameters estimated using large samples
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="07.f.%20Frequentist%20I.html">
     7.5 Confidence Intervals using resampling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="07.g.%20Frequentist%20I.html">
     7.6 Summary: Use of confidence intervals
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="07.h.%20Frequentist%20I.html">
     Further resources
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="08.a.%20Frequentist%20II.html">
   8. Frequentist II: Hypothesis tests
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="08.b.%20Frequentist%20II.html">
     8.1 Evidence against hypotheses
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="08.c.%20Frequentist%20II.html">
     8.2 The p-value
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="08.d.%20Frequentist%20II.html">
     8.3 Connection between p-values and confidence intervals
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="08.e.%20Frequentist%20II.html">
     8.4 Other (mis-)interpretations of p-values
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="08.f.%20Frequentist%20II.html">
     8.5 Calculating p-values
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="08.g.%20Frequentist%20II.html">
     Further resources
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="09.a.%20Bayesian%20Statistics%20I.html">
   9. Bayesian Statistics I
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="09.b.%20Bayesian%20Statistics%20I.html">
     Part 1: 9.1 Introduction to Bayesian Inference
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="09.c.%20Bayesian%20Statistics%20I.html">
     9.2 Bayes Theorem (recap)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="09.d.%20Bayesian%20Statistics%20I.html">
     9.3 The Bayesian paradigm in Health data science problems.
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="09.e.%20Bayesian%20Statistics%20I.html">
     Part 2:  9.4 Bayes thorem for discrete and continous data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="09.f.%20Bayesian%20Statistics%20I.html">
     9.5 Bayesian inference on proportions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="09.g.%20Bayesian%20Statistics%20I.html">
     9.6 Summarising Posteriors
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="09.h.%20Bayesian%20Statistics%20I.html">
     9.7 Prior Predictions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="09.i.%20Bayesian%20Statistics%20I.html">
     9.8 Conjugacy
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="10.a.%20Bayesian%20Statistics%20II.html">
   10. Bayesian Statistics II: Normal data
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
  <label for="toctree-checkbox-9">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="10.b.%20Bayesian%20Statistics%20II.html">
     10.1 Example: CD4 cell counts
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="10.c.%20Bayesian%20Statistics%20II.html">
     Calculating the posterior
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="10.d.%20Bayesian%20Statistics%20II.html">
     10.3 Credible Intervals
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="10.e.%20Bayesian%20Statistics%20II.html">
     10.4 Predictions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="10.f.%20Bayesian%20Statistics%20II.html">
     10.5 Multiparameter models
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="10.g.%20Bayesian%20Statistics%20II.html">
     Further Resources
    </a>
   </li>
  </ul>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Statistical modelling
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="11.a.%20Types%20of%20Investigation.html">
   11. Types of Investigation
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
  <label for="toctree-checkbox-10">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="11.b.%20Types%20of%20Investigation.html">
     11.1 Specifying research questions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="11.c.%20Types%20of%20Investigation.html">
     11.2 Different types of investigation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="11.d.%20Types%20of%20Investigation.html">
     11.3 Properties of different types of investigation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="11.e.%20Types%20of%20Investigation.html">
     11.4 An example: stroke in women
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="11.f.%20Types%20of%20Investigation.html">
     11.5 Role of explanatory variables in different types of investigation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="11.g.%20Types%20of%20Investigation.html">
     11.6 Example: the role of regression in different types of investigation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="11.h.%20Types%20of%20Investigation.html">
     11.7 Summary
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="11.i.%20Types%20of%20Investigation.html">
     References
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="12.a.%20Linear%20Regression%20I.html">
   12. Linear Regression I
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
  <label for="toctree-checkbox-11">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="12.b.%20Linear%20Regression%20I.html">
     12.1 Introduction
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="12.c.%20Linear%20Regression%20I.html">
     12.2 Data used in our examples
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="12.d.%20Linear%20Regression%20I.html">
     12.3 The simple linear regression model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="12.e.%20Linear%20Regression%20I.html">
     12.4 Estimation of the population parameters
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="12.f.%20Linear%20Regression%20I.html">
     12.5 Example: continuous independent variable
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="12.g.%20Linear%20Regression%20I.html">
     12.6 Inference for the slope
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="12.h.%20Linear%20Regression%20I.html">
     12.7 Example: binary independent variable
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="12.i.%20Linear%20Regression%20I.html">
     12.8 Additional material
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="13.a.%20Linear%20Regression%20II.html">
   13. Linear Regression II
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/>
  <label for="toctree-checkbox-12">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="13.b.%20Linear%20Regression%20II.html">
     13.1 Categorical independent variables
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="13.c.%20Linear%20Regression%20II.html">
     13.2 Multivariable linear regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="13.d.%20Linear%20Regression%20II.html">
     13.3 Including multiple covariates
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="13.e.%20Linear%20Regression%20II.html">
     13.4 Centering
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="13.f.%20Linear%20Regression%20II.html">
     13.6  Including higher-order terms
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="13.g.%20Linear%20Regression%20II.html">
     13.7  Modelling interaction terms
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="13.h.%20Linear%20Regression%20II.html">
     13.8 Summary
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="14.a.%20Linear%20Regression%20III.html">
   14. Linear Regression III
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/>
  <label for="toctree-checkbox-13">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="14.b.%20Linear%20Regression%20III.html">
     14.1 Assumptions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="14.c.%20Linear%20Regression%20III.html">
     14.2 Investigating assumptions using plots
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="14.d.%20Linear%20Regression%20III.html">
     14.2 Statistical tests of assumptions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="14.e.%20Linear%20Regression%20III.html">
     14.3 Dealing with violations of assumptions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="14.f.%20Linear%20Regression%20III.html">
     14.5 Collinearity
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="14.g.%20Linear%20Regression%20III.html">
     14.6 Optional Reading: Analysis of Variance
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="14.h.%20Linear%20Regression%20III.html">
     14.7 Proofs
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="15.a.%20Logistic%20Regression.html">
   15 Logistic Regression
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/>
  <label for="toctree-checkbox-14">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="15.b.%20Logistic%20Regression.html">
     15.1 Introduction: linear vs. logistic regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="15.c.%20Logistic%20Regression.html">
     15.2 The dementia dataset
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="15.d.%20Logistic%20Regression.html">
     15.3 The logistic regression model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="15.e.%20Logistic%20Regression.html">
     15.4 Interpretation of the parameters
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="15.f.%20Logistic%20Regression.html">
     15.5 Example 1: Dementia
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="15.g.%20Logistic%20Regression.html">
     15.6 Interpretation when
     <span class="math notranslate nohighlight">
      \(X_i\)
     </span>
     is a continuous variable
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="15.h.%20Logistic%20Regression.html">
     15.7 Example 2: Dementia
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="15.i.%20Logistic%20Regression.html">
     15.8 Interactions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="15.j.%20Logistic%20Regression.html">
     15.9 Example 3: Dementia
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="15.k.%20Logistic%20Regression.html">
     15.10 Diagnosis for the logistic regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="15.l.%20Logistic%20Regression.html">
     15.11 Adequacy of the logistic regression model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="15.m.%20Logistic%20Regression.html">
     15.12 Common pitfalls
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="15.n.%20Logistic%20Regression.html">
     15.13 Optional Reading
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="16.a.%20Poisson%20Regression%20Model.html">
   15. Generalised Linear Models: Poisson Regression for Count Variables
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/>
  <label for="toctree-checkbox-15">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="16.b.%20Poisson%20Regression%20Model.html">
     15.1 Introduction to Count Data and Poisson Distribution:
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="16.c.%20Poisson%20Regression%20Model.html">
     15.2 Introduction to Poisson generalised linear modelling (Poisson Regression)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="16.d.%20Poisson%20Regression%20Model.html">
     15.3 Poisson regression in health data science
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     15.4 How to fit a Poisson Regression in R
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="16.f.%20Poisson%20Regression%20Model.html">
     15.5 Zero Inflated Poisson Regression Example
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/16.e. Poisson Regression Model.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https//github.com//LSHTM-HDS//Content-2021"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https//github.com//LSHTM-HDS//Content-2021/issues/new?title=Issue%20on%20page%20%2F16.e. Poisson Regression Model.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh//LSHTM-HDS/main?urlpath=tree/Jupyter_Book/SHDS/16.e. Poisson Regression Model.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-for-poisson-regression-example">
   15.4.1 Data for Poisson Regression Example
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#output-from-poisson-regression-example">
   15.4.2 Output from Poisson Regression Example
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#creating-robust-standard-errors-from-poisson-regression-example-output">
   15.4.3 Creating robust standard errors from Poisson regression example output.
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#poisson-regression-goodness-of-fit-example">
   15.4.4 Poisson Regression Goodness of Fit Example
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#poisson-regression-example-used-for-prediction">
   15.4.5 Poisson Regression Example used for Prediction
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="how-to-fit-a-poisson-regression-in-r">
<h1>15.4 How to fit a Poisson Regression in R<a class="headerlink" href="#how-to-fit-a-poisson-regression-in-r" title="Permalink to this headline">¶</a></h1>
<p>Similarly to other generalised linear regressions, we fit a Poisson regression through the generalised linear models function glm() where we tell R what the distribution of the errors and linear predictor should be.</p>
<p>You should already be familiar with the glm() function but a quick recap the function syntax is as followed:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>glm(formula, family = gaussian, data, weights, subset,
na.action, start = NULL, etastart, mustart, offset,
control = list(…), model = TRUE, method = &quot;glm.fit&quot;,
x = FALSE, y = TRUE, singular.ok = TRUE, contrasts = NULL, …)
</pre></div>
</div>
<p>The minimal inputted parameters required is the <em>formula</em> and the <em>family</em>. The <em>formula</em> tells R in a symbolic description what model is required to be fitted and the <em>family</em> describes what error distribution and link function are required. As we are going to be fitting Poisson regression the <em>family</em> will be “poisson”, however we can also fit a Quasi-Poisson regression also by setting <em>family</em> to “quasipoisson”.</p>
<div class="section" id="data-for-poisson-regression-example">
<h2>15.4.1 Data for Poisson Regression Example<a class="headerlink" href="#data-for-poisson-regression-example" title="Permalink to this headline">¶</a></h2>
<p>For the purpose of illustration, we will simulate some data and pretend it comes from a clinical trial. We generate 100 participants (<span class="math notranslate nohighlight">\(n\)</span>) in three variables. The first is a count variable representing the number of hospital admissions a participant has had in a year and it is created from a Poisson distribution with <span class="math notranslate nohighlight">\(lambda=2\)</span>. The second is a categorical variable with 4 groups representing the country a participant lives in (England, Northern Ireland, Scotland, Wales) and the last is a binary variable representing which treatment arm the participant was randomised to. Let’s start with simulating the data and looking at some descriptive statistics.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1">## Simulate Data</span>
<span class="nf">set.seed</span><span class="p">(</span><span class="m">42</span><span class="p">)</span>
<span class="n">n</span><span class="o">&lt;-</span><span class="m">100</span>
<span class="n">lambda</span><span class="o">&lt;-</span><span class="m">6</span>
<span class="n">counts</span> <span class="o">&lt;-</span> <span class="nf">rpois</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">lambda</span><span class="p">)</span>
<span class="n">country</span> <span class="o">&lt;-</span>  <span class="nf">factor</span><span class="p">(</span><span class="nf">sample</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="bp">T</span><span class="p">),</span> <span class="n">levels</span><span class="o">=</span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;England&quot;</span><span class="p">,</span><span class="s">&quot;Northern Ireland&quot;</span><span class="p">,</span><span class="s">&quot;Scotland&quot;</span><span class="p">,</span><span class="s">&quot;Wales&quot;</span><span class="p">))</span>
<span class="n">treatment</span> <span class="o">&lt;-</span> <span class="nf">factor</span><span class="p">(</span><span class="nf">gl</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="n">n</span><span class="o">/</span><span class="m">2</span><span class="p">),</span> <span class="n">levels</span><span class="o">=</span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;Active Arm&quot;</span><span class="p">,</span> <span class="s">&quot;Placebo Arm&quot;</span><span class="p">))</span>
<span class="nf">print</span><span class="p">(</span><span class="n">df</span> <span class="o">&lt;-</span> <span class="nf">data.frame</span><span class="p">(</span><span class="n">treatment</span><span class="p">,</span> <span class="n">country</span><span class="p">,</span> <span class="n">counts</span><span class="p">))</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>  
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      treatment          country counts
1    Active Arm Northern Ireland      9
2    Active Arm            Wales     10
3    Active Arm          England      5
4    Active Arm Northern Ireland      8
5    Active Arm          England      7
6    Active Arm Northern Ireland      6
7    Active Arm            Wales      7
8    Active Arm         Scotland      3
9    Active Arm            Wales      7
10   Active Arm          England      7
11   Active Arm            Wales      6
12   Active Arm          England      7
13   Active Arm            Wales     10
14   Active Arm         Scotland      4
15   Active Arm Northern Ireland      6
16   Active Arm Northern Ireland     10
17   Active Arm         Scotland     11
18   Active Arm          England      3
19   Active Arm          England      6
20   Active Arm Northern Ireland      6
21   Active Arm         Scotland      9
22   Active Arm            Wales      3
23   Active Arm            Wales     12
24   Active Arm Northern Ireland     10
25   Active Arm            Wales      3
26   Active Arm          England      6
27   Active Arm          England      5
28   Active Arm            Wales      9
29   Active Arm          England      6
30   Active Arm          England      8
31   Active Arm          England      7
32   Active Arm Northern Ireland      8
33   Active Arm         Scotland      5
34   Active Arm          England      7
35   Active Arm Northern Ireland      1
36   Active Arm            Wales      8
37   Active Arm            Wales      1
38   Active Arm          England      4
39   Active Arm         Scotland      9
40   Active Arm Northern Ireland      7
41   Active Arm          England      5
42   Active Arm          England      5
43   Active Arm Northern Ireland      2
44   Active Arm          England     11
45   Active Arm          England      5
46   Active Arm         Scotland     11
47   Active Arm            Wales      9
48   Active Arm Northern Ireland      7
49   Active Arm         Scotland     11
50   Active Arm Northern Ireland      7
51  Placebo Arm Northern Ireland      5
52  Placebo Arm            Wales      5
53  Placebo Arm          England      5
54  Placebo Arm         Scotland      8
55  Placebo Arm          England      2
56  Placebo Arm          England      8
57  Placebo Arm          England      7
58  Placebo Arm         Scotland      4
59  Placebo Arm         Scotland      4
60  Placebo Arm            Wales      6
61  Placebo Arm          England      7
62  Placebo Arm Northern Ireland     12
63  Placebo Arm Northern Ireland      8
64  Placebo Arm         Scotland      6
65  Placebo Arm Northern Ireland      9
66  Placebo Arm            Wales      4
67  Placebo Arm         Scotland      4
68  Placebo Arm         Scotland      8
69  Placebo Arm Northern Ireland      7
70  Placebo Arm          England      4
71  Placebo Arm            Wales      2
72  Placebo Arm          England      3
73  Placebo Arm            Wales      4
74  Placebo Arm Northern Ireland      6
75  Placebo Arm          England      4
76  Placebo Arm Northern Ireland      7
77  Placebo Arm         Scotland      1
78  Placebo Arm Northern Ireland      5
79  Placebo Arm Northern Ireland      6
80  Placebo Arm            Wales      0
81  Placebo Arm Northern Ireland      6
82  Placebo Arm Northern Ireland      4
83  Placebo Arm Northern Ireland      5
84  Placebo Arm         Scotland      7
85  Placebo Arm Northern Ireland      8
86  Placebo Arm            Wales      6
87  Placebo Arm            Wales      4
88  Placebo Arm         Scotland      3
89  Placebo Arm Northern Ireland      3
90  Placebo Arm Northern Ireland      5
91  Placebo Arm         Scotland      7
92  Placebo Arm            Wales      0
93  Placebo Arm Northern Ireland      4
94  Placebo Arm            Wales     10
95  Placebo Arm            Wales     10
96  Placebo Arm Northern Ireland      7
97  Placebo Arm          England      5
98  Placebo Arm          England      6
99  Placebo Arm Northern Ireland      7
100 Placebo Arm            Wales      7
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>       treatment              country       counts     
 Active Arm :50   England         :27   Min.   : 0.00  
 Placebo Arm:50   Northern Ireland:31   1st Qu.: 4.00  
                  Scotland        :18   Median : 6.00  
                  Wales           :24   Mean   : 6.14  
                                        3rd Qu.: 8.00  
                                        Max.   :12.00  
</pre></div>
</div>
</div>
</div>
<p>We can see that we correctly have 100 participants with 50% in the active arm and 50% in the placebo arm. There is roughly equal number of participants in each country with Northern Ireland having slightly more. The number of hospital admissions ranges from 0 to 6 with the median number of admissions equal to 2.</p>
<p>We can now have a look at the descriptive statistics for admission counts by both treatment and county.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1">#Counts by treatment</span>
<span class="nf">with</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="nf">tapply</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">treatment</span><span class="p">,</span> <span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">{</span>
  <span class="nf">sprintf</span><span class="p">(</span><span class="s">&quot;M (SD) = %1.2f (%1.2f)&quot;</span><span class="p">,</span> <span class="nf">mean</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nf">sd</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="p">}))</span>
<span class="c1">#Counts by country</span>
<span class="nf">with</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="nf">tapply</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">country</span><span class="p">,</span> <span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">{</span>
  <span class="nf">sprintf</span><span class="p">(</span><span class="s">&quot;M (SD) = %1.2f (%1.2f)&quot;</span><span class="p">,</span> <span class="nf">mean</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nf">sd</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="p">}))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><dl class=dl-horizontal>
	<dt>Active Arm</dt>
		<dd>'M (SD) = 6.78 (2.70)'</dd>
	<dt>Placebo Arm</dt>
		<dd>'M (SD) = 5.50 (2.46)'</dd>
</dl>
</div><div class="output text_html"><dl class=dl-horizontal>
	<dt>England</dt>
		<dd>'M (SD) = 5.74 (1.87)'</dd>
	<dt>Northern Ireland</dt>
		<dd>'M (SD) = 6.48 (2.34)'</dd>
	<dt>Scotland</dt>
		<dd>'M (SD) = 6.39 (3.07)'</dd>
	<dt>Wales</dt>
		<dd>'M (SD) = 5.96 (3.42)'</dd>
</dl>
</div></div>
</div>
<p>We can see that the Active arm has a slightly higher count mean than the Placebo arm and Scotland also has a slightly higher mean count. We can also look at this graphically using the ggplot package.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">options</span><span class="p">(</span><span class="n">repr.plot.width</span><span class="o">=</span><span class="m">4</span><span class="p">,</span> <span class="n">repr.plot.height</span><span class="o">=</span><span class="m">3</span><span class="p">)</span>
<span class="nf">install.packages</span><span class="p">(</span><span class="s">&quot;ggplot2&quot;</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span>
<span class="n">g1</span><span class="o">&lt;-</span><span class="nf">ggplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">fill</span> <span class="o">=</span> <span class="n">treatment</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_histogram</span><span class="p">(</span><span class="n">binwidth</span><span class="o">=</span><span class="m">.5</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s">&quot;dodge&quot;</span><span class="p">)</span>
<span class="n">g1</span> <span class="o">+</span> <span class="nf">labs</span><span class="p">(</span><span class="n">fill</span> <span class="o">=</span> <span class="s">&quot;Treament Arm&quot;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s">&quot;Admission Count&quot;</span><span class="p">)</span>

<span class="n">g2</span><span class="o">&lt;-</span><span class="nf">ggplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">fill</span> <span class="o">=</span> <span class="n">country</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_histogram</span><span class="p">(</span><span class="n">binwidth</span><span class="o">=</span><span class="m">.5</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s">&quot;dodge&quot;</span><span class="p">)</span>
<span class="n">g2</span> <span class="o">+</span> <span class="nf">labs</span><span class="p">(</span><span class="n">fill</span> <span class="o">=</span> <span class="s">&quot;Country&quot;</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="s">&quot;Admission Count&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>also installing the dependency &#39;rlang&#39;
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  There is a binary version available but the source version is later:
        binary source needs_compilation
ggplot2  3.3.3  3.3.5             FALSE

package &#39;rlang&#39; successfully unpacked and MD5 sums checked

The downloaded binary packages are in
	C:\Users\quant\AppData\Local\Temp\RtmpC6japP\downloaded_packages
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>installing the source package &#39;ggplot2&#39;
</pre></div>
</div>
<img alt="_images/16.e. Poisson Regression Model_6_3.png" src="_images/16.e. Poisson Regression Model_6_3.png" />
<img alt="_images/16.e. Poisson Regression Model_6_4.png" src="_images/16.e. Poisson Regression Model_6_4.png" />
</div>
</div>
</div>
<div class="section" id="output-from-poisson-regression-example">
<h2>15.4.2 Output from Poisson Regression Example<a class="headerlink" href="#output-from-poisson-regression-example" title="Permalink to this headline">¶</a></h2>
<p>We already know the admissions count variable follows a Poisson distribution as we have simulated the data directly from the distribution without adding noise. Therefore we know a Poisson regression is suitable. We now fit the regression model and store it in the object m1 and get a summary of the model at the same time.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">summary</span><span class="p">(</span><span class="n">m1</span> <span class="o">&lt;-</span> <span class="nf">glm</span><span class="p">(</span><span class="n">counts</span> <span class="o">~</span> <span class="n">treatment</span> <span class="o">+</span> <span class="n">country</span><span class="p">,</span> <span class="n">family</span><span class="o">=</span><span class="s">&quot;poisson&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Call:
glm(formula = counts ~ treatment + country, family = &quot;poisson&quot;, 
    data = df)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-3.2467  -0.5783   0.0477   0.6381   2.2260  

Coefficients:
                        Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)              1.82733    0.08448  21.631  &lt; 2e-16 ***
treatmentPlacebo Arm    -0.23187    0.08226  -2.819  0.00482 ** 
countryNorthern Ireland  0.17001    0.10822   1.571  0.11620    
countryScotland          0.14936    0.12396   1.205  0.22822    
countryWales             0.06669    0.11640   0.573  0.56670    
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 130.13  on 99  degrees of freedom
Residual deviance: 120.53  on 95  degrees of freedom
AIC: 483.69

Number of Fisher Scoring iterations: 5
</pre></div>
</div>
</div>
</div>
<p><strong>OUTPUT</strong></p>
<p>The first part of the output gives information on deviance residuals. We would expect to see the deviance residuals to be approximately normally distributed if the model is correctly specified. Here we can see the median is close to 0 (-0.10) and there does not appear to be any skewness as Q1 (quartile 1 = -0.67) and Q3 (quartile 3 = 0.73) have a similar distance from the median and so are the minimum and maximum.</p>
<p>The second part of the output gives the Poisson regression coefficients for each variable with their standard errors, z values, p-values. We interpret Poisson regression coefficients as if there was a one unit change in the predictor variable (if a continuous variable otherwise change from the reference category to the category listed) the regression coefficient tells us the effect on the logs of the expected counts (admission counts in our example), given the other variables in the model are held constant. The coefficient for treatment is -0.40 which tells use the expected log admissions count for being randomised to the active arm compared to the placebo arm is -0.40. The expected log admissions count for the other countries compared to England are all positive.</p>
<p>We can also see the regression estimate when all the variables in the model are evaluated at zero (or categorical reference group) and this is called the constant and labelled “_cons”. In our model this would represent the expected log admissions count for participants in the placebo arm who live in England.</p>
<p>The standard errors are given which are used to calculate the z-value which in turn is used to calculate the p value. The null hypothesis for each p value is that the corresponding regression coefficient is zero given the rest of the variables in the model. The z value here is just the ratio of the coefficient to the standard error for example treatment we can see the estimate/standard error equals the z value: -0.3971/0.1421=-2.795. The z value follows a normal distribution and is tested against a two-sided alternative hypothesis that the coefficient is not equal to zero. We can see for treatment the p value is 0.005 and if we set out alpha significant level at <span class="math notranslate nohighlight">\(\alpha=0.05\)</span> we would reject the null hypothesis and conclude the Poisson regression coefficient for treatment is statistically different from zero, given country is in the model.</p>
<p>Lastly, at the bottom of the output, we have information on the residual deviance which can be used to perform a goodness of fit test for the overall model. We will come back to this in section 14.5.4.</p>
</div>
<div class="section" id="creating-robust-standard-errors-from-poisson-regression-example-output">
<h2>15.4.3 Creating robust standard errors from Poisson regression example output.<a class="headerlink" href="#creating-robust-standard-errors-from-poisson-regression-example-output" title="Permalink to this headline">¶</a></h2>
<p>As previously covered in section 14.2.3.3, the mean of the Poisson distribution is equal to the variance. A publication here (<a class="reference external" href="https://onlinelibrary.wiley.com/doi/full/10.1111/1475-4932.12006">https://onlinelibrary.wiley.com/doi/full/10.1111/1475-4932.12006</a>) recommends using robust standard errors when this assumption is mildly violated. We can create robust standard errors using the sandwich package in R.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1">#Robust SE&#39;s</span>
<span class="nf">install.packages</span><span class="p">(</span><span class="s">&quot;sandwich&quot;</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">sandwich</span><span class="p">)</span>
<span class="n">cov</span> <span class="o">&lt;-</span> <span class="nf">vcovHC</span><span class="p">(</span><span class="n">m1</span><span class="p">,</span> <span class="n">type</span><span class="o">=</span><span class="s">&quot;HC0&quot;</span><span class="p">)</span>
<span class="n">se</span> <span class="o">&lt;-</span> <span class="nf">sqrt</span><span class="p">(</span><span class="nf">diag</span><span class="p">(</span><span class="n">cov</span><span class="p">))</span>
<span class="n">robust.SE</span> <span class="o">&lt;-</span> <span class="nf">cbind</span><span class="p">(</span><span class="n">Estimate</span><span class="o">=</span> <span class="nf">coef</span><span class="p">(</span><span class="n">m1</span><span class="p">),</span> <span class="s">&quot;Robust SE&quot;</span> <span class="o">=</span> <span class="n">se</span><span class="p">,</span> <span class="s">&quot;Pr(&gt;|z|)&quot;</span> <span class="o">=</span> <span class="m">2</span> <span class="o">*</span> <span class="nf">pnorm</span><span class="p">(</span><span class="nf">abs</span><span class="p">(</span><span class="nf">coef</span><span class="p">(</span><span class="n">m1</span><span class="p">)</span><span class="o">/</span><span class="n">se</span><span class="p">)))</span>
<span class="n">robust.SE</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  There is a binary version available but the source version is later:
         binary source needs_compilation
sandwich  3.0-0  3.0-1             FALSE
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>installing the source package &#39;sandwich&#39;
</pre></div>
</div>
<div class="output text_html"><table>
<thead><tr><th></th><th scope=col>Estimate</th><th scope=col>Robust SE</th><th scope=col>Pr(&gt;|z|)</th></tr></thead>
<tbody>
	<tr><th scope=row>(Intercept)</th><td> 1.82733439</td><td>0.06412168 </td><td>2.000000   </td></tr>
	<tr><th scope=row>treatmentPlacebo Arm</th><td>-0.23187287</td><td>0.08541705 </td><td>1.993364   </td></tr>
	<tr><th scope=row>countryNorthern Ireland</th><td> 0.17000567</td><td>0.09156736 </td><td>1.936635   </td></tr>
	<tr><th scope=row>countryScotland</th><td> 0.14936415</td><td>0.11986847 </td><td>1.787260   </td></tr>
	<tr><th scope=row>countryWales</th><td> 0.06668722</td><td>0.12436880 </td><td>1.408183   </td></tr>
</tbody>
</table>
</div></div>
</div>
<p>Here we have the robust standard errors (Robust SE) and the new calculated p values. In this example we see that the robust standard errors are very similar to the previous calculated standard errors, this is because we know the distribution was simulated from a Poisson distribution and hence the mean and variance are approximately the same. However in other settings calculating the robust standard error would lead less bias if the mean and variance were slightly different.</p>
</div>
<div class="section" id="poisson-regression-goodness-of-fit-example">
<h2>15.4.4 Poisson Regression Goodness of Fit Example<a class="headerlink" href="#poisson-regression-goodness-of-fit-example" title="Permalink to this headline">¶</a></h2>
<p>At the bottom of the output we see the null deviance and residual deviance from the model. The residual deviance is 104.71 on 95 degrees of freedom (df). There are 100 observations in our model and 5 estimates which gives us 95 df (100-1df for treatment- 3df for each country – 1df for the constant) . To calculate the p-value for the deviance goodness of fit test we simply calculate the probability to the right of the deviance value for the chi-squared distribution on 95 df.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">pchisq</span><span class="p">(</span><span class="n">m1</span><span class="o">$</span><span class="n">deviance</span><span class="p">,</span> <span class="n">df</span><span class="o">=</span><span class="n">m1</span><span class="o">$</span><span class="n">df.residual</span><span class="p">,</span> <span class="n">lower.tail</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">0.0395607905595946</div></div>
</div>
<p>The null hypothesis is that our model is correctly specified. Here we can see the p value is 0.233 which is not significant if we set our level of significant at 0.05. We therefore do not have strong evidence to reject the null hypothesis. If however there was strong evidence that the model was not fitting well, a possible method to improve fit could be to omit a variable from the model which could be adversely affecting the linearity or dispersion criteria. For example we could fit an alternative model where we remove country.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Update m1 model dropping country</span>
<span class="n">m2</span> <span class="o">&lt;-</span> <span class="nf">update</span><span class="p">(</span><span class="n">m1</span><span class="p">,</span> <span class="n">. </span><span class="o">~</span> <span class="n">. </span><span class="o">-</span> <span class="n">country</span><span class="p">)</span>
<span class="c1"># Test models with chi square test</span>
<span class="nf">anova</span><span class="p">(</span><span class="n">m2</span><span class="p">,</span> <span class="n">m1</span><span class="p">,</span> <span class="n">test</span><span class="o">=</span><span class="s">&quot;Chisq&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table>
<thead><tr><th scope=col>Resid. Df</th><th scope=col>Resid. Dev</th><th scope=col>Df</th><th scope=col>Deviance</th><th scope=col>Pr(&gt;Chi)</th></tr></thead>
<tbody>
	<tr><td>98       </td><td>123.4508 </td><td>NA       </td><td>      NA </td><td>       NA</td></tr>
	<tr><td>95       </td><td>120.5336 </td><td> 3       </td><td>2.917207 </td><td>0.4045671</td></tr>
</tbody>
</table>
</div></div>
</div>
<p>We can see by the non-significant p value of 0.598 that by adding Country to the model we do not get an improve fit and thus the model would fit approximately as well without it.</p>
</div>
<div class="section" id="poisson-regression-example-used-for-prediction">
<h2>15.4.5 Poisson Regression Example used for Prediction<a class="headerlink" href="#poisson-regression-example-used-for-prediction" title="Permalink to this headline">¶</a></h2>
<p>One of the great things about regression is it can be used to make predictions, for example we may want to predict what the expected admissions counts would be for each country while assuming everyone is in the placebo treatment. To have a look how this will work we create a small dataset.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">dp</span> <span class="o">&lt;-</span> <span class="nf">data.frame</span><span class="p">(</span><span class="n">treatment</span> <span class="o">=</span> <span class="nf">factor</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="m">1</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;Placebo Arm&quot;</span><span class="p">)),</span> <span class="n">country</span> <span class="o">=</span> <span class="nf">factor</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="nf">levels</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">country</span><span class="p">)))</span>
<span class="n">dp</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table>
<thead><tr><th scope=col>treatment</th><th scope=col>country</th></tr></thead>
<tbody>
	<tr><td>Placebo Arm     </td><td>England         </td></tr>
	<tr><td>Placebo Arm     </td><td>Northern Ireland</td></tr>
	<tr><td>Placebo Arm     </td><td>Scotland        </td></tr>
	<tr><td>Placebo Arm     </td><td>Wales           </td></tr>
</tbody>
</table>
</div></div>
</div>
<p>We now use the output from the regression to predict the admissions counts for each country.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">predict</span><span class="p">(</span><span class="n">m1</span><span class="p">,</span> <span class="n">dp</span><span class="p">,</span> <span class="n">type</span><span class="o">=</span><span class="s">&quot;response&quot;</span><span class="p">,</span> <span class="n">se.fit</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><dl>
	<dt>$fit</dt>
		<dd><dl class=dl-horizontal>
	<dt>1</dt>
		<dd>4.9306041274169</dd>
	<dt>2</dt>
		<dd>5.84430214232171</dd>
	<dt>3</dt>
		<dd>5.72490336621881</dd>
	<dt>4</dt>
		<dd>5.27062387515433</dd>
</dl>
</dd>
	<dt>$se.fit</dt>
		<dd><dl class=dl-horizontal>
	<dt>1</dt>
		<dd>0.483047207431936</dd>
	<dt>2</dt>
		<dd>0.471629350298954</dd>
	<dt>3</dt>
		<dd>0.583886748993777</dd>
	<dt>4</dt>
		<dd>0.502721588866226</dd>
</dl>
</dd>
	<dt>$residual.scale</dt>
		<dd>1</dd>
</dl>
</div></div>
</div>
<p>In the output we can see the predicted number of admissions counts for each country assuming everyone is taking placebo treatment. Scotland has the highest predicted count with England having the lowest. We can also graphically show predictions for different permutations of data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">options</span><span class="p">(</span><span class="n">repr.plot.width</span><span class="o">=</span><span class="m">10</span><span class="p">,</span> <span class="n">repr.plot.height</span><span class="o">=</span><span class="m">3</span><span class="p">)</span>
<span class="c1">## Calculate and store predicted values</span>
<span class="n">df</span><span class="o">$</span><span class="n">pred</span> <span class="o">&lt;-</span> <span class="nf">predict</span><span class="p">(</span><span class="n">m1</span><span class="p">,</span> <span class="n">type</span><span class="o">=</span><span class="s">&quot;response&quot;</span><span class="p">)</span>

<span class="c1"># Create the plot</span>
<span class="nf">ggplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">country</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">pred</span><span class="p">,</span> <span class="n">colour</span> <span class="o">=</span> <span class="n">treatment</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_point</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">y</span> <span class="o">=</span> <span class="n">pred</span><span class="p">))</span> <span class="o">+</span> <span class="nf">labs</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="s">&quot;Treatment Arm&quot;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s">&quot;Expected number of admissions&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/16.e. Poisson Regression Model_23_0.png" src="_images/16.e. Poisson Regression Model_23_0.png" />
</div>
</div>
<p>Here we can see graphically the predicted admissions count for each country for each treatment arm, to have the lowest predicted number of hospital admissions you would want to be living in England and in the Placebo arm.</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "r"
        },
        kernelOptions: {
            kernelName: "ir",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'ir'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="16.d.%20Poisson%20Regression%20Model.html" title="previous page">15.3 Poisson regression in health data science</a>
    <a class='right-next' id="next-link" href="16.f.%20Poisson%20Regression%20Model.html" title="next page">15.5 Zero Inflated Poisson Regression Example</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By MSc Health Data Science, LSHTM<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>